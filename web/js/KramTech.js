!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module){function FlyCamera(){this.__ktCamCtrls=!0,this.camera=null,this.target=new Vector3(0,0,0),this.angle=new Vector2(0,0),this.speed=.5,this.lastDrag=null,this.sensitivity=new Vector2(.5,.5),this.onlyOnLock=!0,this.maxAngle=KTMath.degToRad(75)}var Input=require("./KTInput"),KTMath=require("./KTMath"),Vector2=require("./KTVector2"),Vector3=require("./KTVector3");module.exports=FlyCamera,FlyCamera.prototype.keyboardControls=function(){var cam=this.camera,moved=!1;return Input.isKeyDown(Input.vKey.W)?(cam.position.x+=Math.cos(this.angle.x)*this.speed,cam.position.y+=Math.sin(this.angle.y)*this.speed,cam.position.z-=Math.sin(this.angle.x)*this.speed,moved=!0):Input.isKeyDown(Input.vKey.S)&&(cam.position.x-=Math.cos(this.angle.x)*this.speed,cam.position.y-=Math.sin(this.angle.y)*this.speed,cam.position.z+=Math.sin(this.angle.x)*this.speed,moved=!0),Input.isKeyDown(Input.vKey.A)?(cam.position.x+=Math.cos(this.angle.x+KTMath.PI_2)*this.speed,cam.position.z-=Math.sin(this.angle.x+KTMath.PI_2)*this.speed,moved=!0):Input.isKeyDown(Input.vKey.D)&&(cam.position.x-=Math.cos(this.angle.x+KTMath.PI_2)*this.speed,cam.position.z+=Math.sin(this.angle.x+KTMath.PI_2)*this.speed,moved=!0),moved},FlyCamera.prototype.mouseControls=function(){if(!this.onlyOnLock||Input.mouseLocked){var moved=!1;null==this.lastDrag&&(this.lastDrag=Input._mouse.position.clone());var dx=Input._mouse.position.x-this.lastDrag.x,dy=Input._mouse.position.y-this.lastDrag.y;return(0!=dx||0!=dy)&&(this.angle.x-=KTMath.degToRad(dx*this.sensitivity.x),this.angle.y-=KTMath.degToRad(dy*this.sensitivity.y),this.angle.y<-this.maxAngle&&(this.angle.y=-this.maxAngle),this.angle.y>this.maxAngle&&(this.angle.y=this.maxAngle),moved=!0),this.lastDrag.copy(Input._mouse.position),moved}},FlyCamera.prototype.update=function(){if(!this.camera.locked){var mK=this.keyboardControls(),mM=this.mouseControls();(mK||mM)&&this.setCameraPosition()}},FlyCamera.prototype.setCameraPosition=function(){var cam=this.camera,x=cam.position.x+Math.cos(this.angle.x),y=cam.position.y+Math.sin(this.angle.y),z=cam.position.z-Math.sin(this.angle.x);this.target.set(x,y,z),this.camera.lookAt(this.target)},FlyCamera.prototype.setCamera=function(camera){this.camera=camera;var zoom=Vector3.vectorsDifference(camera.position,this.target).length();this.angle.x=(-KTMath.get2DAngle(this.target.x,this.target.z,camera.position.x,camera.position.z)+KTMath.PI2)%KTMath.PI2,this.angle.y=(-KTMath.get2DAngle(0,camera.position.y,zoom,this.target.y)+KTMath.PI2)%KTMath.PI2,this.setCameraPosition()}},{"./KTInput":16,"./KTMath":25,"./KTVector2":38,"./KTVector3":39}],2:[function(require,module){function CameraOrtho(width,height,znear,zfar){this.__ktcamera=!0,this.position=new Vector3(0,0,0),this.upVector=new Vector3(0,1,0),this.lookAt(new Vector3(0,0,-1)),this.locked=!1,this.width=width,this.height=height,this.znear=znear,this.zfar=zfar,this.controls=null,this.setOrtho()}var Matrix4=require("./KTMatrix4"),Vector3=(require("./KTColor"),require("./KTVector3")),KTMath=require("./KTMath");module.exports=CameraOrtho,CameraOrtho.prototype.setOrtho=function(){var C=2/this.width,R=2/this.height,A=-2/(this.zfar-this.znear),B=-(this.zfar+this.znear)/(this.zfar-this.znear);this.perspectiveMatrix=new Matrix4(C,0,0,0,0,R,0,0,0,0,A,B,0,0,0,1)},CameraOrtho.prototype.lookAt=function(vector3){if(!vector3.__ktv3)throw"Can only look to a vector3";var forward=Vector3.vectorsDifference(this.position,vector3).normalize(),left=this.upVector.cross(forward).normalize(),up=forward.cross(left).normalize(),x=-left.dot(this.position),y=-up.dot(this.position),z=-forward.dot(this.position);return this.transformationMatrix=new Matrix4(left.x,left.y,left.z,x,up.x,up.y,up.z,y,forward.x,forward.y,forward.z,z,0,0,0,1),this},CameraOrtho.prototype.setControls=function(cameraControls){if(!cameraControls.__ktCamCtrls)throw"Is not a valid camera controls object";var zoom=Vector3.vectorsDifference(this.position,cameraControls.target).length();return this.controls=cameraControls,cameraControls.camera=this,cameraControls.zoom=zoom,cameraControls.angle.x=KTMath.get2DAngle(cameraControls.target.x,cameraControls.target.z,this.position.x,this.position.z),cameraControls.angle.y=KTMath.get2DAngle(0,this.position.y,zoom,cameraControls.target.y),cameraControls.setCameraPosition(),this}},{"./KTColor":5,"./KTMath":25,"./KTMatrix4":27,"./KTVector3":39}],3:[function(require,module){function CameraPerspective(fov,ratio,znear,zfar){this.__ktcamera=!0,this.position=new Vector3(0,0,0),this.upVector=new Vector3(0,1,0),this.lookAt(new Vector3(0,0,-1)),this.locked=!1,this.fov=fov,this.ratio=ratio,this.znear=znear,this.zfar=zfar,this.controls=null,this.skybox=null,this.setPerspective()}var Matrix4=require("./KTMatrix4"),Vector3=(require("./KTColor"),require("./KTVector3")),GeometrySkybox=(require("./KTMath"),require("./KTGeometrySkybox"));module.exports=CameraPerspective,CameraPerspective.prototype.setPerspective=function(){var C=1/Math.tan(this.fov/2),R=C*this.ratio,A=(this.znear+this.zfar)/(this.znear-this.zfar),B=2*this.znear*this.zfar/(this.znear-this.zfar);this.perspectiveMatrix=new Matrix4(C,0,0,0,0,R,0,0,0,0,A,B,0,0,-1,0)},CameraPerspective.prototype.setSkybox=function(texture){this.skybox=new GeometrySkybox(this.position,texture)},CameraPerspective.prototype.lookAt=function(vector3){if(!vector3.__ktv3)throw"Can only look to a vector3";var forward=Vector3.vectorsDifference(this.position,vector3).normalize(),left=this.upVector.cross(forward).normalize(),up=forward.cross(left).normalize(),x=-left.dot(this.position),y=-up.dot(this.position),z=-forward.dot(this.position);return this.transformationMatrix=new Matrix4(left.x,left.y,left.z,x,up.x,up.y,up.z,y,forward.x,forward.y,forward.z,z,0,0,0,1),this},CameraPerspective.prototype.setControls=function(cameraControls){if(!cameraControls.__ktCamCtrls)throw"Is not a valid camera controls object";return this.controls=cameraControls,cameraControls.setCamera(this),this}},{"./KTColor":5,"./KTGeometrySkybox":13,"./KTMath":25,"./KTMatrix4":27,"./KTVector3":39}],4:[function(require,module){function Clock(){this.lastF=Date.now(),this.currentF=this.lastF,this.startF=this.lastF,this.frames=0,this.fps=0,this.delta=0;var T=this;Utils.addEvent(window,"focus",function(){T.reset()})}var Utils=require("./KTUtils");module.exports=Clock,Clock.prototype.update=function(fps){this.lastF=this.currentF-this.delta%fps,this.fps=Math.floor(1e3*(++this.frames/(this.currentF-this.startF)))},Clock.prototype.getDelta=function(){return this.currentF=Date.now(),this.delta=this.currentF-this.lastF,this.delta},Clock.prototype.reset=function(){this.startF=Date.now(),this.frames=0}},{"./KTUtils":37}],5:[function(require,module){function Color(hexColor){var str=hexColor.substring(1);6==str.length&&(str+="FF");var r=parseInt(str.substring(0,2),16),g=parseInt(str.substring(2,4),16),b=parseInt(str.substring(4,6),16),a=parseInt(str.substring(6,8),16);this.color=[r/255,g/255,b/255,a/255]}module.exports=Color,Color.prototype.set=function(hexColor){var str=hexColor.substring(1);6==str.length&&(str+="FF");var r=parseInt(str.substring(0,2),16),g=parseInt(str.substring(2,4),16),b=parseInt(str.substring(4,6),16),a=parseInt(str.substring(6,8),16);this.color=[r/255,g/255,b/255,a/255]},Color.prototype.setRGB=function(red,green,blue){this.setRGBA(red,green,blue,255)},Color.prototype.setRGBA=function(red,green,blue,alpha){this.color=[red/255,green/255,blue/255,alpha]},Color.prototype.getRGB=function(){var c=this.getRGBA();return[c[0],c[1],c[2]]},Color.prototype.getRGBA=function(){return this.color},Color.prototype.getHex=function(){var c=this.color,r=(255*c[0]).toString(16),g=(255*c[1]).toString(16),b=(255*c[2]).toString(16),a=(255*c[3]).toString(16);return 1==r.length&&(r="0"+r),1==g.length&&(g="0"+g),1==b.length&&(b="0"+b),1==a.length&&(a="0"+a),("#"+r+g+b+a).toUpperCase()},Color._BLACK="#000000FF",Color._RED="#FF0000FF",Color._GREEN="#00FF00FF",Color._BLUE="#0000FFFF",Color._WHITE="#FFFFFFFF",Color._YELLOW="#FFFF00FF",Color._MAGENTA="#FF00FFFF",Color._AQUA="#00FFFFFF",Color._GOLD="#FFD700FF",Color._GRAY="#808080FF",Color._PURPLE="#800080FF"},{}],6:[function(require,module){function Geometry(){this.__ktgeometry=!0,this.clear(),this.uvRegion=new Vector4(0,0,1,1),this.boundingBox=null}var KT=require("./KTMain"),Color=require("./KTColor"),Vector2=(require("./KTMatrix4"),require("./KTVector2")),Vector3=require("./KTVector3"),Vector4=require("./KTVector4");module.exports=Geometry,Geometry.prototype.clear=function(){this.vertices=[],this.triangles=[],this.uvCoords=[],this.colors=[],this.normals=[],this.vertexBuffer=null,this.texBuffer=null,this.facesBuffer=null,this.colorsBuffer=null,this.normalsBuffer=null,this.ready=!1},Geometry.prototype.addVertice=function(x,y,z,color,tx,ty){color||(color=Color._WHITE),tx||(tx=0),ty||(ty=0);var ind=this.vertices.length;return this.vertices.push(new Vector3(x,y,z)),this.colors.push(new Color(color)),this.uvCoords.push(new Vector2(tx,ty)),ind},Geometry.prototype.addFace=function(vertice_0,vertice_1,vertice_2){if(!this.vertices[vertice_0])throw"Invalid vertex index: "+vertice_0;if(!this.vertices[vertice_1])throw"Invalid vertex index: "+vertice_1;if(!this.vertices[vertice_2])throw"Invalid vertex index: "+vertice_2;this.triangles.push(new Vector3(vertice_0,vertice_1,vertice_2))},Geometry.prototype.addNormal=function(nx,ny,nz){this.normals.push(new Vector3(nx,ny,nz))},Geometry.prototype.build=function(){for(var vertices=[],uvCoords=[],triangles=[],colors=[],normals=[],i=0,len=this.vertices.length;len>i;i++){var v=this.vertices[i];vertices.push(v.x,v.y,v.z)}for(var i=0,len=this.uvCoords.length;len>i;i++){var v=this.uvCoords[i];uvCoords.push(v.x,v.y)}for(var i=0,len=this.triangles.length;len>i;i++){var t=this.triangles[i];triangles.push(t.x,t.y,t.z)}for(var i=0,len=this.colors.length;len>i;i++){var c=this.colors[i].getRGBA();colors.push(c[0],c[1],c[2],c[3])}for(var i=0,len=this.normals.length;len>i;i++){var n=this.normals[i];normals.push(n.x,n.y,n.z)}return this.vertexBuffer=KT.createArrayBuffer("ARRAY_BUFFER",new Float32Array(vertices),3),this.texBuffer=KT.createArrayBuffer("ARRAY_BUFFER",new Float32Array(uvCoords),2),this.facesBuffer=KT.createArrayBuffer("ELEMENT_ARRAY_BUFFER",new Uint16Array(triangles),1),this.colorsBuffer=KT.createArrayBuffer("ARRAY_BUFFER",new Float32Array(colors),4),this.normalsBuffer=KT.createArrayBuffer("ARRAY_BUFFER",new Float32Array(normals),3),this.ready=!0,this},Geometry.prototype.computeFacesNormals=function(){this.normals=[];for(var normalizedVertices=[],i=0,len=this.triangles.length;len>i;i++){var face=this.triangles[i],v0=this.vertices[face.x],v1=this.vertices[face.y],v2=this.vertices[face.z],dir1=Vector3.vectorsDifference(v1,v0),dir2=Vector3.vectorsDifference(v2,v0),normal=dir1.cross(dir2).normalize();-1==normalizedVertices.indexOf(face.x)&&this.normals.push(normal),-1==normalizedVertices.indexOf(face.y)&&this.normals.push(normal),-1==normalizedVertices.indexOf(face.z)&&this.normals.push(normal),normalizedVertices.push(face.x,face.y,face.z)}return this},Geometry.prototype.computeBoundingBox=function(){for(var x1,x2,y1,y2,z1,z2,i=0,len=this.vertices.length;len>i;i++){var v=this.vertices[i];0==i?(x1=v.x,y1=v.y,z1=v.z,x2=v.x,y2=v.y,z2=v.z):(x1=Math.min(x1,v.x),y1=Math.min(y1,v.y),z1=Math.min(z1,v.z),x2=Math.max(x2,v.x),y2=Math.max(y2,v.y),z2=Math.max(z2,v.z))}return this.boundingBox={x1:x1,y1:y1,z1:z1,x2:x2,y2:y2,z2:z2},this}},{"./KTColor":5,"./KTMain":20,"./KTMatrix4":27,"./KTVector2":38,"./KTVector3":39,"./KTVector4":40}],7:[function(require,module){function Geometry3DModel(fileURL){this.__ktgeometry=!0,this.fileURL=fileURL,this.ready=!1,this.uvRegion=new Vector4(0,0,1,1);var T=this;Utils.getFileContent(fileURL,function(file){T.ready=!0,T.parseFile(file)})}var Color=require("./KTColor"),Geometry=require("./KTGeometry"),Utils=require("./KTUtils"),Vector2=require("./KTVector2"),Vector3=require("./KTVector3"),Vector4=require("./KTVector4");module.exports=Geometry3DModel,Geometry3DModel.prototype.parseFile=function(file){for(var lines=file.split("\r\n"),vertexMin=[],uvCoordMin=[],normalMin=[],indMin=[],geometry=new Geometry,i=0,len=lines.length;len>i;i++){var l=lines[i].trim();l=l.replace("  "," ");var ind=l.charAt(0),p=l.split(" ");p.splice(0,1),"#"!=ind&&"g"!=ind&&""!=l&&(0==l.indexOf("v ")?vertexMin.push(new Vector3(parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2]))):0==l.indexOf("vn ")?normalMin.push(new Vector3(parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2]))):0==l.indexOf("vt ")?uvCoordMin.push(new Vector2(parseFloat(p[0]),parseFloat(p[1]))):0==l.indexOf("f ")&&indMin.push(new Vector3(p[0],p[1],p[2])))}for(var i=0,len=indMin.length;len>i;i++){var ind=indMin[i],vertexInfo1=ind.x.split("/"),vertexInfo2=ind.y.split("/"),vertexInfo3=ind.z.split("/"),v1=vertexMin[parseInt(vertexInfo1[0])-1],t1=uvCoordMin[parseInt(vertexInfo1[1])-1],n1=normalMin[parseInt(vertexInfo1[2])-1],v2=vertexMin[parseInt(vertexInfo2[0])-1],t2=uvCoordMin[parseInt(vertexInfo2[1])-1],n2=normalMin[parseInt(vertexInfo2[2])-1],v3=vertexMin[parseInt(vertexInfo3[0])-1],t3=uvCoordMin[parseInt(vertexInfo3[1])-1],n3=normalMin[parseInt(vertexInfo3[2])-1],i1=geometry.addVertice(v1.x,v1.y,v1.z,Color._WHITE,t1.x,t1.y),i2=geometry.addVertice(v2.x,v2.y,v2.z,Color._WHITE,t2.x,t2.y),i3=geometry.addVertice(v3.x,v3.y,v3.z,Color._WHITE,t3.x,t3.y);geometry.addNormal(n1.x,n1.y,n1.z),geometry.addNormal(n2.x,n2.y,n2.z),geometry.addNormal(n3.x,n3.y,n3.z),geometry.addFace(i1,i2,i3)}geometry.build(),this.vertexBuffer=geometry.vertexBuffer,this.texBuffer=geometry.texBuffer,this.facesBuffer=geometry.facesBuffer,this.colorsBuffer=geometry.colorsBuffer,this.normalsBuffer=geometry.normalsBuffer}},{"./KTColor":5,"./KTGeometry":6,"./KTUtils":37,"./KTVector2":38,"./KTVector3":39,"./KTVector4":40}],8:[function(require,module){function GeometryBillboard(width,height,params){this.__ktgeometry=!0,this.ready=!0;var billGeo=new Geometry,w=width/2,h=height/2;params||(params={}),this.params=params,this.uvRegion=params.uvRegion?params.uvRegion:new Vector4(0,0,1,1),this.colorTop=params.colorTop?params.colorTop:Color._WHITE,this.colorBottom=params.colorBottom?params.colorBottom:Color._WHITE,this.spherical=void 0!==params.spherical?params.spherical:!0;var xr=this.uvRegion.x,yr=this.uvRegion.y,hr=this.uvRegion.z,vr=this.uvRegion.w;billGeo.addVertice(w,-h,0,this.colorBottom,hr,yr),billGeo.addVertice(-w,h,0,this.colorTop,xr,vr),billGeo.addVertice(-w,-h,0,this.colorBottom,xr,yr),billGeo.addVertice(w,h,0,this.colorTop,hr,vr),billGeo.addFace(0,1,2),billGeo.addFace(0,3,1),billGeo.computeFacesNormals(),billGeo.build(),this.vertexBuffer=billGeo.vertexBuffer,this.texBuffer=billGeo.texBuffer,this.facesBuffer=billGeo.facesBuffer,this.colorsBuffer=billGeo.colorsBuffer,this.normalsBuffer=billGeo.normalsBuffer}var Color=require("./KTColor"),Geometry=require("./KTGeometry"),Vector4=require("./KTVector4");module.exports=GeometryBillboard},{"./KTColor":5,"./KTGeometry":6,"./KTVector4":40}],9:[function(require,module){function GeometryBox(width,length,height,params){this.__ktgeometry=!0,this.ready=!0;var boxGeo=new Geometry,w=width/2,l=length/2,h=height/2;params||(params={}),this.params=params,this.uvRegion=params.uvRegion?params.uvRegion:new Vector4(0,0,1,1),this.colorTop=params.colorTop?params.colorTop:Color._WHITE,this.colorBottom=params.colorBottom?params.colorBottom:Color._WHITE;var xr=this.uvRegion.x,yr=this.uvRegion.y,hr=this.uvRegion.z,vr=this.uvRegion.w;boxGeo.addVertice(w,-h,l,this.colorBottom,hr,yr),boxGeo.addVertice(-w,h,l,this.colorTop,xr,vr),boxGeo.addVertice(-w,-h,l,this.colorBottom,xr,yr),boxGeo.addVertice(w,h,l,this.colorTop,hr,vr),boxGeo.addVertice(-w,-h,-l,this.colorBottom,xr,yr),boxGeo.addVertice(-w,h,-l,this.colorTop,xr,vr),boxGeo.addVertice(w,-h,-l,this.colorBottom,hr,yr),boxGeo.addVertice(w,h,-l,this.colorTop,hr,vr),boxGeo.addVertice(w,-h,-l,this.colorBottom,hr,yr),boxGeo.addVertice(w,h,l,this.colorTop,xr,vr),boxGeo.addVertice(w,-h,l,this.colorBottom,xr,yr),boxGeo.addVertice(w,h,-l,this.colorTop,hr,vr),boxGeo.addVertice(-w,-h,l,this.colorBottom,hr,yr),boxGeo.addVertice(-w,h,l,this.colorTop,hr,vr),boxGeo.addVertice(-w,-h,-l,this.colorBottom,xr,yr),boxGeo.addVertice(-w,h,-l,this.colorTop,xr,vr),boxGeo.addVertice(w,h,l,this.colorTop,hr,yr),boxGeo.addVertice(-w,h,-l,this.colorTop,xr,vr),boxGeo.addVertice(-w,h,l,this.colorTop,xr,yr),boxGeo.addVertice(w,h,-l,this.colorTop,hr,vr),boxGeo.addVertice(-w,-h,l,this.colorBottom,xr,vr),boxGeo.addVertice(-w,-h,-l,this.colorBottom,xr,yr),boxGeo.addVertice(w,-h,l,this.colorBottom,hr,vr),boxGeo.addVertice(w,-h,-l,this.colorBottom,hr,yr),boxGeo.addFace(0,1,2),boxGeo.addFace(0,3,1),boxGeo.addFace(4,5,6),boxGeo.addFace(5,7,6),boxGeo.addFace(8,9,10),boxGeo.addFace(8,11,9),boxGeo.addFace(12,13,14),boxGeo.addFace(13,15,14),boxGeo.addFace(16,17,18),boxGeo.addFace(16,19,17),boxGeo.addFace(20,21,22),boxGeo.addFace(21,23,22),boxGeo.computeFacesNormals(),boxGeo.computeBoundingBox(),boxGeo.build(),this.vertexBuffer=boxGeo.vertexBuffer,this.texBuffer=boxGeo.texBuffer,this.facesBuffer=boxGeo.facesBuffer,this.colorsBuffer=boxGeo.colorsBuffer,this.normalsBuffer=boxGeo.normalsBuffer,this.boundingBox=boxGeo.boundingBox}var Color=require("./KTColor"),Geometry=require("./KTGeometry"),Vector4=require("./KTVector4");module.exports=GeometryBox},{"./KTColor":5,"./KTGeometry":6,"./KTVector4":40}],10:[function(require,module){function GeometryCylinder(radiusTop,radiusBottom,height,widthSegments,heightSegments,openTop,openBottom,params){this.__ktgeometry=!0,this.ready=!0;var cylGeo=new Geometry;params||(params={}),this.params=params,this.uvRegion=params.uvRegion?params.uvRegion:new Vector4(0,0,1,1);for(var xr=this.uvRegion.x,yr=this.uvRegion.y,hr=this.uvRegion.z-xr,vr=this.uvRegion.w-yr,h=height/2,bandW=KTMath.PI2/(widthSegments-1),i=0;widthSegments>i;i++){var x1=Math.cos(bandW*i),y1=-h,z1=-Math.sin(bandW*i),x2=Math.cos(bandW*i),y2=h,z2=-Math.sin(bandW*i),xt=i/(widthSegments-1);cylGeo.addNormal(x1,0,z1),cylGeo.addNormal(x2,0,z2),x1*=radiusBottom,z1*=radiusBottom,x2*=radiusTop,z2*=radiusTop,cylGeo.addVertice(x1,y1,z1,Color._WHITE,xr+xt*hr,yr),cylGeo.addVertice(x2,y2,z2,Color._WHITE,xr+xt*hr,yr+vr)}for(var i=0;2*widthSegments-2>i;i+=2){var i1=i,i2=i+1,i3=i+2,i4=i+3;cylGeo.addFace(i3,i2,i1),cylGeo.addFace(i3,i4,i2)}if(!openTop||!openBottom){var i1=cylGeo.addVertice(0,h,0,Color._WHITE,xr+.5*hr,yr+.5*vr),i2=cylGeo.addVertice(0,-h,0,Color._WHITE,xr+.5*hr,yr+.5*vr);cylGeo.addNormal(0,1,0),cylGeo.addNormal(0,-1,0);for(var i=0;2*widthSegments-2>i;i+=2){var v1=cylGeo.vertices[i+1],v2=cylGeo.vertices[i+3],tx1=xr+(v1.x/2+.5)*hr,ty1=yr+(v1.z/2+.5)*vr,tx2=xr+(v2.x/2+.5)*hr,ty2=yr+(v2.z/2+.5)*vr;if(!openTop){var i3=cylGeo.addVertice(v1.x,h,v1.z,Color._WHITE,tx1,ty1),i4=cylGeo.addVertice(v2.x,h,v2.z,Color._WHITE,tx2,ty2);cylGeo.addNormal(0,1,0),cylGeo.addNormal(0,1,0),cylGeo.addFace(i4,i1,i3)}if(!openBottom){var i3=cylGeo.addVertice(v1.x,-h,v1.z,Color._WHITE,tx1,ty1),i4=cylGeo.addVertice(v2.x,-h,v2.z,Color._WHITE,tx2,ty2);cylGeo.addNormal(0,-1,0),cylGeo.addNormal(0,-1,0),cylGeo.addFace(i3,i2,i4)}}}cylGeo.build(),this.vertexBuffer=cylGeo.vertexBuffer,this.texBuffer=cylGeo.texBuffer,this.facesBuffer=cylGeo.facesBuffer,this.colorsBuffer=cylGeo.colorsBuffer,this.normalsBuffer=cylGeo.normalsBuffer}var Color=require("./KTColor"),Geometry=require("./KTGeometry"),Vector4=require("./KTVector4"),KTMath=require("./KTMath");module.exports=GeometryCylinder},{"./KTColor":5,"./KTGeometry":6,"./KTMath":25,"./KTVector4":40}],11:[function(require,module){function GeometryGUITexture(width,height,params){this.__ktgeometry=!0,this.ready=!0;var guiTex=new Geometry,x1=0,y1=0,x2=width,y2=height;params||(params={}),this.params=params,this.uvRegion=params.uvRegion?params.uvRegion:new Vector4(0,0,1,1);var xr=this.uvRegion.x,yr=this.uvRegion.y,hr=this.uvRegion.z,vr=this.uvRegion.w;guiTex.addVertice(x2,y1,0,Color._WHITE,hr,yr),guiTex.addVertice(x1,y2,0,Color._WHITE,xr,vr),guiTex.addVertice(x1,y1,0,Color._WHITE,xr,yr),guiTex.addVertice(x2,y2,0,Color._WHITE,hr,vr),guiTex.addFace(0,1,2),guiTex.addFace(0,3,1),guiTex.computeFacesNormals(),guiTex.build(),this.vertexBuffer=guiTex.vertexBuffer,this.texBuffer=guiTex.texBuffer,this.facesBuffer=guiTex.facesBuffer,this.colorsBuffer=guiTex.colorsBuffer,this.normalsBuffer=guiTex.normalsBuffer}var Color=require("./KTColor"),Geometry=require("./KTGeometry"),Vector4=require("./KTVector4");module.exports=GeometryGUITexture},{"./KTColor":5,"./KTGeometry":6,"./KTVector4":40}],12:[function(require,module){function GeometryPlane(width,height,params){this.__ktgeometry=!0,this.ready=!0;var planeGeo=new Geometry,w=width/2,h=height/2;params||(params={}),this.params=params,this.uvRegion=params.uvRegion?params.uvRegion:new Vector4(0,0,1,1);var xr=this.uvRegion.x,yr=this.uvRegion.y,hr=this.uvRegion.z,vr=this.uvRegion.w;planeGeo.addVertice(w,0,h,Color._WHITE,hr,yr),planeGeo.addVertice(-w,0,-h,Color._WHITE,xr,vr),planeGeo.addVertice(-w,0,h,Color._WHITE,xr,yr),planeGeo.addVertice(w,0,-h,Color._WHITE,hr,vr),planeGeo.addFace(0,1,2),planeGeo.addFace(0,3,1),planeGeo.computeFacesNormals(),planeGeo.build(),this.vertexBuffer=planeGeo.vertexBuffer,this.texBuffer=planeGeo.texBuffer,this.facesBuffer=planeGeo.facesBuffer,this.colorsBuffer=planeGeo.colorsBuffer,this.normalsBuffer=planeGeo.normalsBuffer}var Color=require("./KTColor"),Geometry=require("./KTGeometry"),Vector4=require("./KTVector4");module.exports=GeometryPlane},{"./KTColor":5,"./KTGeometry":6,"./KTVector4":40}],13:[function(require,module){function GeometrySkybox(position,texture){this.meshes=[],this.texture=texture,this.boxGeo=new KT.GeometryBox(1,1,1),this.box=new KT.Mesh(this.boxGeo,new MaterialBasic),this.box.position=position,this.setMaterial()}var Material=(require("./KTColor"),require("./KTGeometry"),require("./KTVector4"),require("./KTMaterial")),MaterialBasic=require("./KTMaterialBasic"),KT=(require("./KTMesh"),require("./KTGeometryPlane"),require("./KTMain"));module.exports=GeometrySkybox,GeometrySkybox.material=null,GeometrySkybox.prototype.setMaterial=function(){if(!GeometrySkybox.material){var material=new Material({shader:KT.shaders.skybox,sendAttribData:function(mesh){for(var gl=KT.gl,geometry=mesh.geometry,attributes=this.shader.attributes,i=0,len=attributes.length;len>i;i++){var att=attributes[i];"aVertexPosition"==att.name&&(gl.bindBuffer(gl.ARRAY_BUFFER,geometry.vertexBuffer),gl.vertexAttribPointer(att.location,geometry.vertexBuffer.itemSize,gl.FLOAT,!1,0,0))}},sendUniformData:function(mesh,camera,scene,texture){for(var gl=KT.gl,uniforms=this.shader.uniforms,i=0,len=uniforms.length;len>i;i++){var uni=uniforms[i];if("uMVPMatrix"==uni.name){var mvp=mesh.getTransformationMatrix(camera).multiply(camera.transformationMatrix).multiply(camera.perspectiveMatrix);gl.uniformMatrix4fv(uni.location,!1,mvp.toFloat32Array())}else"uCubemap"==uni.name&&(gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_CUBE_MAP,texture.texture),gl.uniform1i(uni.location,0))}}});GeometrySkybox.material=material}},GeometrySkybox.prototype.render=function(camera,scene){var material=GeometrySkybox.material;material.sendAttribData(this.box,camera,scene),material.sendUniformData(this.box,camera,scene,this.texture)}},{"./KTColor":5,"./KTGeometry":6,"./KTGeometryPlane":12,"./KTMain":20,"./KTMaterial":21,"./KTMaterialBasic":22,"./KTMesh":28,"./KTVector4":40}],14:[function(require,module){function GeometrySphere(radius,latBands,lonBands,params){this.__ktgeometry=!0,this.ready=!0;var sphGeo=new Geometry;params||(params={}),this.params=params,this.uvRegion=params.uvRegion?params.uvRegion:new Vector4(0,0,1,1);for(var xr=this.uvRegion.x,yr=this.uvRegion.y,hr=this.uvRegion.z-xr,vr=this.uvRegion.w-yr,hs=params.halfSphere?1:2,latN=0;latBands>=latN;latN++)for(var theta=latN*Math.PI/latBands,cosT=Math.cos(theta),sinT=Math.sin(theta),lonN=0;lonBands>=lonN;lonN++){var phi=lonN*hs*Math.PI/lonBands,cosP=Math.cos(phi),sinP=Math.sin(phi),x=cosP*sinT,y=cosT,z=sinP*sinT,tx=lonN/lonBands,ty=1-latN/latBands;sphGeo.addNormal(x,y,z),sphGeo.addVertice(x*radius,y*radius,z*radius,Color._WHITE,xr+tx*hr,yr+ty*vr)}for(var latN=0;latBands>latN;latN++)for(var lonN=0;lonBands>lonN;lonN++){var i1=lonN+latN*(lonBands+1),i2=i1+lonBands+1,i3=i1+1,i4=i2+1;sphGeo.addFace(i4,i1,i3),sphGeo.addFace(i4,i2,i1)}sphGeo.build(),this.vertexBuffer=sphGeo.vertexBuffer,this.texBuffer=sphGeo.texBuffer,this.facesBuffer=sphGeo.facesBuffer,this.colorsBuffer=sphGeo.colorsBuffer,this.normalsBuffer=sphGeo.normalsBuffer}var Color=require("./KTColor"),Geometry=require("./KTGeometry"),Vector4=require("./KTVector4");module.exports=GeometrySphere},{"./KTColor":5,"./KTGeometry":6,"./KTVector4":40}],15:[function(require,module){function GeometryText(font,text,size,align,color,maxWidth,wrap){this.__ktgeometry=!0,this.ready=!0,this.textGeometry=new Geometry,align||(align=KT.TEXT_ALIGN_LEFT),color||(color=Color._WHITE),this.uvRegion=new Vector4(0,0,1,1),this.size=size,this.text=text,this.font=font,this.align=align,this.color=color,this.maxWidth=maxWidth?maxWidth:-1,this.wrap=wrap?wrap:"char",this._previousHeight=null,this._previousText=null,this._previousFont=null,this._previousAlign=null,this._previousColor=null,this.autoUpdate=!0,this.updateGeometry()}var KT=require("./KTMain"),Color=require("./KTColor"),Geometry=require("./KTGeometry"),Vector4=require("./KTVector4");module.exports=GeometryText,GeometryText.prototype.hasChanged=function(){return this.size!=this._previousSize||this.text!=this._previousText||this.font!=this._previousFont||this.align!=this._previousAlign||this.color!=this._previousColor},GeometryText.prototype.formatText=function(){if("word"!=this.wrap)return[this.text];for(var ret=[],line="",width=0,words=this.text.split(" "),last=!0,blank=this.size*this.font.getCharaWidth(" "),i=0,len=words.length;len>i;i++){for(var w=words[i],ww=blank,j=0,jlen=w.length;jlen>j;j++)ww+=this.size*this.font.getCharaWidth(w.charAt(j));width+ww<this.maxWidth?(""!=line&&(line+=" "),line+=w,width+=ww,last=!1):(ret.push(line),line=w,width=ww,last=!0)}return last||ret.push(line),ret},GeometryText.prototype.updateGeometry=function(){if(this.hasChanged()){this._previousSize=this.size,this._previousText=this.text,this._previousFont=this.font,this._previousAlign=this.align,this._previousColor=this.color,this.vertexBuffer=null,this.texBuffer=null,this.facesBuffer=null,this.colorsBuffer=null,this.normalsBuffer=null,this.textGeometry.clear();for(var text=this.formatText(),y=0,w=this.size,h=this.size,ind=0,j=0,jlen=text.length;jlen>j;j++){for(var x=0,i=0,len=text[j].length;len>i;i++){var chara=text[j].charAt(i),uvRegion=this.font.getUVCoords(chara),xr=uvRegion.x,yr=uvRegion.y,hr=uvRegion.z,vr=uvRegion.w,ww=w*this.font.getCharaWidth(chara),xw=x+ww;-1!=this.maxWidth&&"char"==this.wrap&&xw>=this.maxWidth?(x=0,y-=this.size,i--):(this.textGeometry.addVertice(xw,y,0,this.color,hr,yr),this.textGeometry.addVertice(x,y+h,0,this.color,xr,vr),this.textGeometry.addVertice(x,y,0,this.color,xr,yr),this.textGeometry.addVertice(xw,y+h,0,this.color,hr,vr),this.textGeometry.addFace(ind,ind+1,ind+2),this.textGeometry.addFace(ind,ind+3,ind+1),x+=ww,ind+=4)}y-=this.size}if(this.align==KT.TEXT_ALIGN_CENTER)for(var w2=x/2,i=0,len=this.textGeometry.vertices.length;len>i;i++)this.textGeometry.vertices[i].x-=w2;else if(this.align==KT.TEXT_ALIGN_RIGHT)for(var w2=x,i=0,len=this.textGeometry.vertices.length;len>i;i++)this.textGeometry.vertices[i].x-=w2;this.textGeometry.computeFacesNormals(),this.textGeometry.build(),this.vertexBuffer=this.textGeometry.vertexBuffer,this.texBuffer=this.textGeometry.texBuffer,this.facesBuffer=this.textGeometry.facesBuffer,this.colorsBuffer=this.textGeometry.colorsBuffer,this.normalsBuffer=this.textGeometry.normalsBuffer,this.width=x}}},{"./KTColor":5,"./KTGeometry":6,"./KTMain":20,"./KTVector4":40}],16:[function(require,module){var Utils=require("./KTUtils"),Vector2=(require("./KTMain"),require("./KTVector2")),Input={_keys:[],_mouse:{left:0,right:0,middle:0,wheel:0,position:new Vector2(0,0)},vKey:{SHIFT:16,TAB:9,CTRL:17,ALT:18,SPACE:32,ENTER:13,BACKSPACE:8,ESC:27,INSERT:45,DEL:46,END:35,START:36,PAGEUP:33,PAGEDOWN:34},vMouse:{LEFT:"left",RIGHT:"right",MIDDLE:"middle",WHEELUP:1,WHEELDOWN:-1},useLockPointer:!1,mouseLocked:!1,isKeyDown:function(keyCode){return 1==Input._keys[keyCode]},isKeyPressed:function(keyCode){return 1==Input._keys[keyCode]?(Input._keys[keyCode]=2,!0):!1},isMouseDown:function(mouseButton){return 1==Input._mouse[mouseButton]},isMousePressed:function(mouseButton){return 1==Input._mouse[mouseButton]?(Input._mouse[mouseButton]=2,!0):!1},isWheelMoved:function(wheelDir){return Input._mouse.wheel==wheelDir?(Input._mouse.wheel=0,!0):!1},handleKeyDown:function(ev){window.event&&(ev=window.event),2!=Input._keys[ev.keyCode]&&(Input._keys[ev.keyCode]=1)},handleKeyUp:function(ev){window.event&&(ev=window.event),Input._keys[ev.keyCode]=0},handleMouseDown:function(ev,canvas){return window.event&&(ev=window.event),Input.useLockPointer&&canvas.requestPointerLock(),1==ev.which?2!=Input._mouse.left&&(Input._mouse.left=1):2==ev.which?2!=Input._mouse.middle&&(Input._mouse.middle=1):3==ev.which&&2!=Input._mouse.right&&(Input._mouse.right=1),Input.handleMouseMove(ev),!1},handleMouseUp:function(ev){return window.event&&(ev=window.event),1==ev.which?Input._mouse.left=0:2==ev.which?Input._mouse.middle=0:3==ev.which&&(Input._mouse.right=0),Input.handleMouseMove(ev),!1},handleMouseWheel:function(ev){window.event&&(ev=window.event),Input._mouse.wheel=0,ev.wheelDelta>0?Input._mouse.wheel=1:ev.wheelDelta<0&&(Input._mouse.wheel=-1)},handleMouseMove:function(ev){if(!Input.mouseLocked){window.event&&(ev=window.event);var elX=ev.clientX-ev.target.offsetLeft,elY=ev.clientY-ev.target.offsetTop;Input._mouse.position.set(elX,elY)}},moveCallback:function(e){var elX=e.movementX||e.mozMovementX||e.webkitMovementX||0,elY=e.movementY||e.mozMovementY||e.webkitMovementY||0;Input._mouse.position.add(new Vector2(elX,elY))},pointerlockchange:function(e,canvas){document.pointerLockElement===canvas||document.mozPointerLockElement===canvas||document.webkitPointerLockElement===canvas?(Input.mouseLocked=!0,Utils.addEvent(document,"mousemove",Input.moveCallback)):(Input.mouseLocked=!1,document.removeEventListener("mousemove",Input.moveCallback))},init:function(canvas){canvas.requestPointerLock=canvas.requestPointerLock||canvas.webkitRequestPointerLock||canvas.mozRequestPointerLock,Utils.addEvent(document,"keydown",Input.handleKeyDown),Utils.addEvent(document,"keyup",Input.handleKeyUp),Utils.addEvent(canvas,"mousedown",function(e){Input.handleMouseDown(e,canvas)}),Utils.addEvent(document,"mouseup",Input.handleMouseUp),Utils.addEvent(canvas,"mousewheel",Input.handleMouseWheel),Utils.addEvent(canvas,"mousemove",Input.handleMouseMove),Utils.addEvent(document,"contextmenu",function(ev){return window.event&&(ev=window.event),ev.target===canvas?(ev.cancelBubble=!0,ev.returnValue=!1,ev.preventDefault&&ev.preventDefault(),ev.stopPropagation&&ev.stopPropagation(),!1):!0}),Utils.addEvent(document,"pointerlockchange",function(e){Input.pointerlockchange(e,canvas)}),Utils.addEvent(document,"mozpointerlockchange",function(e){Input.pointerlockchange(e,canvas)}),Utils.addEvent(document,"webkitpointerlockchange",function(e){Input.pointerlockchange(e,canvas)});for(var i=0;9>=i;i++)Input.vKey["N"+i]=48+i,Input.vKey["NK"+i]=96+i;for(var i=65;90>=i;i++)Input.vKey[String.fromCharCode(i)]=i;for(var i=1;12>=i;i++)Input.vKey["F"+i]=111+i}};module.exports=Input},{"./KTMain":20,"./KTUtils":37,"./KTVector2":38}],17:[function(require,module){function DirectionalLight(direction,color,intensity){this.__ktdirLight=!0,this.direction=direction.normalize(),this.direction.multiply(-1),this.color=new Color(color?color:Color._WHITE),this.intensity=void 0!==intensity?intensity:1,this.castShadow=!1,this.shadowCam=null,this.shadowBuffer=null,this.shadowCamWidth=500,this.shadowCamHeight=500,this.shadowNear=.1,this.shadowFar=500,this.shadowResolution=new Vector2(512,512),this.shadowStrength=.2
}var Color=require("./KTColor"),CameraOrtho=require("./KTCameraOrtho"),Vector2=require("./KTVector2"),TextureFramebuffer=require("./KTTextureFramebuffer");module.exports=DirectionalLight,DirectionalLight.prototype.setCastShadow=function(castShadow){if(this.castShadow=castShadow,castShadow){{this.shadowResolution.x/this.shadowResolution.y}this.shadowCam=new CameraOrtho(this.shadowCamWidth,this.shadowCamHeight,this.shadowNear,this.shadowFar),this.shadowCam.position=this.direction.clone().multiply(10),this.shadowCam.lookAt(this.direction.clone().multiply(-1)),this.shadowBuffer=new TextureFramebuffer(this.shadowResolution.x,this.shadowResolution.y)}else this.shadowCam=null,this.shadowBuffer=null}},{"./KTCameraOrtho":2,"./KTColor":5,"./KTTextureFramebuffer":36,"./KTVector2":38}],18:[function(require,module){function LightPoint(position,intensity,distance,color){this.__ktpointlight=!0,this.position=position,this.intensity=intensity?intensity:1,this.distance=distance?distance:1,this.color=new Color(color?color:Color._WHITE)}var Color=require("./KTColor");module.exports=LightPoint},{"./KTColor":5}],19:[function(require,module){function LightSpot(position,target,innerAngle,outerAngle,intensity,distance,color){this.__ktspotlight=!0,this.position=position,this.target=target,this.direction=Vector3.vectorsDifference(position,target).normalize(),this.outerAngle=Math.cos(outerAngle),this.innerAngle=Math.cos(innerAngle),this.intensity=intensity?intensity:1,this.distance=distance?distance:1,this.color=new Color(color?color:Color._WHITE),this.castShadow=!1,this.shadowCam=null,this.shadowBuffer=null,this.shadowFov=KT.Math.degToRad(90),this.shadowNear=.1,this.shadowFar=500,this.shadowResolution=new Vector2(512,512),this.shadowStrength=.2}var KT=require("./KTMain"),Color=require("./KTColor"),Vector3=require("./KTVector3"),Vector2=require("./KTVector2"),TextureFramebuffer=require("./KTTextureFramebuffer");module.exports=LightSpot,LightSpot.prototype.setCastShadow=function(castShadow){if(this.castShadow=castShadow,castShadow){var rel=this.shadowResolution.x/this.shadowResolution.y;this.shadowCam=new KT.CameraPerspective(this.shadowFov,rel,this.shadowNear,this.shadowFar),this.shadowCam.position=this.position,this.shadowCam.lookAt(this.target),this.shadowBuffer=new TextureFramebuffer(this.shadowResolution.x,this.shadowResolution.y)}else this.shadowCam=null,this.shadowBuffer=null},LightSpot.prototype.setShadowProperties=function(fov,near,far,resolution){this.shadowFov=fov,this.shadowNear=near,this.shadowFar=far,this.shadowResolution=resolution}},{"./KTColor":5,"./KTMain":20,"./KTTextureFramebuffer":36,"./KTVector2":38,"./KTVector3":39}],20:[function(require,module){var KT={TEXT_ALIGN_LEFT:0,TEXT_ALIGN_CENTER:1,TEXT_ALIGN_RIGHT:2,init:function(canvas,params){this.canvas=canvas,this.gl=null,this.shaders={},this.images=[],this.maxAttribLocations=0,this.lastProgram=null,this.__initModules(params),this.__initContext(canvas),this.__initProperties(),this.__initShaders(),this.__initParams(),this.__createMissingTexture(),this.clock=new Clock,this.looping=!0,Input.init(canvas)},__initContext:function(canvas){return this.gl=canvas.getContext("experimental-webgl"),this.gl?(this.gl.width=canvas.width,void(this.gl.height=canvas.height)):(alert("Your browser doesn't support WebGL"),!1)},__initProperties:function(){var gl=this.gl;gl.enable(gl.DEPTH_TEST),gl.depthFunc(gl.LEQUAL),gl.enable(gl.CULL_FACE),gl.disable(gl.BLEND),gl.blendEquation(gl.FUNC_ADD),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)},__initShaders:function(){this.shaders={},this.modules.basicMaterial&&(this.shaders.basic=this.processShader(Shaders.basic)),this.modules.lambertMaterial&&(this.shaders.lambert=this.processShader(Shaders.lambert)),this.modules.phongMaterial&&(this.shaders.phong=this.processShader(Shaders.phong)),this.modules.skyboxMaterial&&(this.shaders.skybox=this.processShader(Shaders.skybox)),this.modules.shadowMapping&&(this.shaders.depth=this.processShader(Shaders.depthMap))},__initParams:function(){this.lightNDCMat=new Matrix4(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1)},__initModules:function(params){params||(params={}),this.modules={specularLight:void 0!==params.specularLight?params.specularLight:!0,shadowMapping:void 0!==params.shadowMapping?params.shadowMapping:!0,basicMaterial:void 0!==params.basicMaterial?params.basicMaterial:!0,lambertMaterial:void 0!==params.lambertMaterial?params.lambertMaterial:!0,phongMaterial:void 0!==params.phongMaterial?params.phongMaterial:!0,skyboxMaterial:void 0!==params.skyboxMaterial?params.skyboxMaterial:!0},this.fps=params.limitFPS?params.limitFPS:1e3/60},__createMissingTexture:function(){for(var data=[],c1=[66,66,66],c2=[122,122,122],c3=[200,200,200],c4=[255,255,255],yy=0,y=0;64>y;y++){for(var xx=0,x=0;256>x;x+=4){var c;32>xx&&32>yy||xx>=32&&yy>=32?(c=c2,32>xx&&32>yy?(16>xx&&16>yy||xx>=16&&yy>=16)&&(c=c1):(48>xx&&48>yy||xx>=48&&yy>=48)&&(c=c1)):(c=c4,xx>=32&&32>yy?(48>xx&&16>yy||xx>=48&&yy>=16)&&(c=c3):32>xx&&yy>=32&&(16>xx&&48>yy||xx>=16&&yy>=48)&&(c=c3)),data[256*y+x+0]=c[0],data[256*y+x+1]=c[1],data[256*y+x+2]=c[2],data[256*y+x+3]=255,xx++}yy++}this.missingTexture=new Texture({data:new Uint8Array(data),width:64,height:64})},createArrayBuffer:function(type,dataArray,itemSize){var gl=this.gl,buffer=gl.createBuffer();return gl.bindBuffer(gl[type],buffer),gl.bufferData(gl[type],dataArray,gl.STATIC_DRAW),buffer.numItems=dataArray.length,buffer.itemSize=itemSize,buffer},getShaderAttributesAndUniforms:function(vertex,fragment){for(var attributes=[],uniforms=[],uniformsNames=[],structs=[],uniformsArrays=[],st=null,i=0;i<vertex.length;i++){var line=vertex[i].trim();if(0==line.indexOf("attribute ")){st=null;var p=line.split(/ /g),name=p[p.length-1].trim();-1==attributes.indexOf(name)&&attributes.push({name:name})}else if(0==line.indexOf("uniform ")){if(st=null,-1!=line.indexOf("[")){uniformsArrays.push(line);continue}var p=line.split(/ /g),name=p[p.length-1].trim();-1==uniformsNames.indexOf(name)&&(uniforms.push({name:name}),uniformsNames.push(name))}else if(0==line.indexOf("struct"))st={name:line.replace("struct ",""),data:[]},structs.push(st);else if(null!=st){if(""==line.trim())continue;var p=line.split(/ /g),name=p[p.length-1].trim();st.data.push(name)}}for(var i=0;i<fragment.length;i++){var line=fragment[i].trim();if(0==line.indexOf("attribute ")){st=null;var p=line.split(/ /g),name=p[p.length-1].trim();-1==attributes.indexOf(name)&&attributes.push({name:name})}else if(0==line.indexOf("uniform ")){if(st=null,-1!=line.indexOf("[")){uniformsArrays.push(line);continue}var p=line.split(/ /g),name=p[p.length-1].trim();-1==uniformsNames.indexOf(name)&&(uniforms.push({name:name}),uniformsNames.push(name))}else if(-1!=line.indexOf("struct"))st={name:line.replace("struct ",""),data:[]},structs.push(st);else if(null!=st){if(""==line.trim())continue;var p=line.split(/ /g),name=p[p.length-1].trim();st.data.push(name)}}for(var i=0,len=uniformsArrays.length;len>i;i++){for(var line=uniformsArrays[i],p=line.split(/ /g),type=p[p.length-2].trim(),name=p[p.length-1].trim(),uniLen=parseInt(name.substring(name.indexOf("[")+1,name.indexOf("]")),10),name=name.substring(0,name.indexOf("[")),str=null,j=0,jlen=structs.length;jlen>j;j++)structs[j].name==type&&(str=structs[j],j=jlen);if(str){for(var structUni=[],j=0;uniLen>j;j++){structUni[j]={name:name,len:uniLen,data:[]};for(var k=0,klen=str.data.length;klen>k;k++){var prop=str.data[k];structUni[j].data.push({name:prop,locName:name+"["+j+"]."+prop})}}-1==uniformsNames.indexOf(name)&&(uniforms.push({multi:!0,data:structUni,type:type}),uniformsNames.push(name))}else for(var j=0;uniLen>j;j++)-1==uniformsNames.indexOf(name+"["+j+"]")&&(uniforms.push({name:name+"["+j+"]",type:name}),uniformsNames.push(name))}return{attributes:attributes,uniforms:uniforms}},precompileShader:function(shaderCode){var modulars=Shaders.modulars,ret=shaderCode,sl=this.modules.specularLight;ret=ret.replace("#kt_require(specular_in)",sl?modulars.specular_in:""),ret=ret.replace("#kt_require(specular_main)",sl?modulars.specular_main:"");var sm=this.modules.shadowMapping;return ret=ret.replace("#kt_require(shadowmap_vert_in)",sm?modulars.shadowmap_vert_in:""),ret=ret.replace("#kt_require(shadowmap_vert_main)",sm?modulars.shadowmap_vert_main:""),ret=ret.replace("#kt_require(shadowmap_frag_in)",sm?modulars.shadowmap_frag_in:""),ret=ret.replace("#kt_require(shadowmap_frag_main)",sm?modulars.shadowmap_frag_main:"")},processShader:function(shader){var gl=this.gl,vCode=this.precompileShader(shader.vertexShader),vShader=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(vShader,vCode),gl.compileShader(vShader);var fCode=this.precompileShader(shader.fragmentShader),fShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fShader,fCode),gl.compileShader(fShader);var shaderProgram=gl.createProgram();gl.attachShader(shaderProgram,vShader),gl.attachShader(shaderProgram,fShader),gl.linkProgram(shaderProgram);var params=this.getShaderAttributesAndUniforms(vCode.split(/[;{}]+/),fCode.split(/[;{}]+/));if(!gl.getShaderParameter(vShader,gl.COMPILE_STATUS))throw console.log(gl.getShaderInfoLog(vShader)),"Error compiling vertex shader";if(!gl.getShaderParameter(fShader,gl.COMPILE_STATUS))throw console.log(gl.getShaderInfoLog(fShader)),"Error compiling fragment shader";if(!gl.getProgramParameter(shaderProgram,gl.LINK_STATUS))throw console.log(gl.getProgramInfoLog(shaderProgram)),"Error initializing the shader program";var attributes=[];this.maxAttribLocations=Math.max(this.maxAttribLocations,params.attributes.length);for(var i=0,len=params.attributes.length;len>i;i++){var att=params.attributes[i],location=gl.getAttribLocation(shaderProgram,att.name);gl.enableVertexAttribArray(location),attributes.push({name:att.name,location:location})}for(var uniforms=[],i=0,len=params.uniforms.length;len>i;i++){var uni=params.uniforms[i];if(uni.multi){for(var j=0,jlen=uni.data.length;jlen>j;j++)for(var uniD=uni.data[j],k=0,klen=uniD.data.length;klen>k;k++){var dat=uniD.data[k];dat.location=gl.getUniformLocation(shaderProgram,dat.locName)}uniforms.push(uni)}else{var location=gl.getUniformLocation(shaderProgram,uni.name);uniforms.push({name:uni.name,location:location,type:uni.type?uni.type:uni.name})}}return{shaderProgram:shaderProgram,attributes:attributes,uniforms:uniforms}},switchProgram:function(shader){if(this.lastProgram!==shader){var gl=this.gl;this.lastProgram=shader,gl.useProgram(shader.shaderProgram);for(var i=0;i<this.maxAttribLocations;i++)i<shader.attributes.length?gl.enableVertexAttribArray(i):gl.disableVertexAttribArray(i)}},loadImage:function(src,onLoad){var img=this.getImage(src);if(img)return img.ready?onLoad(img):img.callers.push(onLoad),img;var image=new Image;return image.src=src,image.ready=!1,image.callers=[onLoad],this.images.push({src:src,img:image}),Utils.addEvent(image,"load",function(){image.ready=!0;for(var i=0,len=image.callers.length;len>i;i++)image.callers[i](image);image.callers=null}),image},getImage:function(src){for(var i=0,len=this.images.length;len>i;i++)if(this.images[i].src==src)return this.images[i].img;return null},setLoopMethod:function(callback){var delta=this.clock.getDelta();if(delta>this.fps&&(this.clock.update(this.fps),callback()),!this.looping)return void(this.looping=!0);var T=this;requestAnimFrame(function(){T.setLoopMethod(callback)})},stopLoopMethod:function(){this.looping=!1}};module.exports=KT;var requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(callback){window.setTimeout(callback,KT.fps)}}(),Clock=require("./KTClock"),Shaders=require("./KTShaders"),Input=require("./KTInput"),Matrix4=require("./KTMatrix4"),Utils=require("./KTUtils"),Texture=require("./KTTexture")},{"./KTClock":4,"./KTInput":16,"./KTMatrix4":27,"./KTShaders":32,"./KTTexture":33,"./KTUtils":37}],21:[function(require,module){function Material(parameters){this.__ktmaterial=!0,parameters||(parameters={}),this.textureMap=parameters.textureMap?parameters.textureMap:null,this.color=new Color(parameters.color?parameters.color:Color._WHITE),this.opacity=parameters.opacity?parameters.opacity:1,this.transparent=parameters.transparent?parameters.transparent:!1,this.drawFaces=parameters.drawFaces?parameters.drawFaces:"FRONT",this.drawAs=parameters.drawAs?parameters.drawAs:"TRIANGLES",this.shader=parameters.shader?parameters.shader:null,this.sendAttribData=parameters.sendAttribData?parameters.sendAttribData:null,this.sendUniformData=parameters.sendUniformData?parameters.sendUniformData:null}{var Color=require("./KTColor");require("./KTMain")}module.exports=Material},{"./KTColor":5,"./KTMain":20}],22:[function(require,module){function MaterialBasic(textureMap,color){this.__ktmaterial=!0;var material=new Material({textureMap:textureMap,color:color,shader:KT.shaders.basic});this.textureMap=material.textureMap,this.color=material.color,this.shader=material.shader,this.opacity=material.opacity,this.drawFaces=material.drawFaces,this.drawAs=material.drawAs,this.transparent=material.transparent}var Material=require("./KTMaterial"),KT=(require("./KTMatrix4"),require("./KTMain"));module.exports=MaterialBasic,MaterialBasic.prototype.sendAttribData=function(mesh){for(var gl=KT.gl,geometry=mesh.geometry,attributes=this.shader.attributes,i=0,len=attributes.length;len>i;i++){var att=attributes[i];"aVertexPosition"==att.name?(gl.bindBuffer(gl.ARRAY_BUFFER,geometry.vertexBuffer),gl.vertexAttribPointer(att.location,geometry.vertexBuffer.itemSize,gl.FLOAT,!1,0,0)):"aVertexColor"==att.name?(gl.bindBuffer(gl.ARRAY_BUFFER,geometry.colorsBuffer),gl.vertexAttribPointer(att.location,geometry.colorsBuffer.itemSize,gl.FLOAT,!1,0,0)):"aTextureCoord"==att.name&&(gl.bindBuffer(gl.ARRAY_BUFFER,geometry.texBuffer),gl.vertexAttribPointer(att.location,geometry.texBuffer.itemSize,gl.FLOAT,!1,0,0))}},MaterialBasic.prototype.sendUniformData=function(mesh,camera){for(var transformationMatrix,gl=KT.gl,uniforms=(mesh.geometry,this.shader.uniforms),i=0,len=uniforms.length;len>i;i++){var uni=uniforms[i];if("uMVPMatrix"==uni.name){transformationMatrix=mesh.getTransformationMatrix(camera).multiply(camera.transformationMatrix);var mvp=transformationMatrix.clone().multiply(camera.perspectiveMatrix);gl.uniformMatrix4fv(uni.location,!1,mvp.toFloat32Array())}else if("uMaterialColor"==uni.name){var color=mesh.material.color.getRGBA();gl.uniform4fv(uni.location,new Float32Array(color))}else if("uTextureSampler"==uni.name){if(mesh.material.textureMap){var tex=mesh.material.textureMap;tex.image&&!tex.image.ready&&(tex=KT.missingTexture),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,tex.texture),gl.uniform1i(uni.location,0)}}else if("uHasTexture"==uni.name)gl.uniform1i(uni.location,mesh.material.textureMap?1:0);else if("uTextureRepeat"==uni.name&&mesh.material.textureMap){var repeat=mesh.material.repeat?mesh.material.repeat:mesh.material.textureMap.repeat;gl.uniform2f(uni.location,repeat.x,repeat.y)}else"uGeometryUV"==uni.name&&mesh.material.textureMap?gl.uniform4f(uni.location,mesh.geometry.uvRegion.x,mesh.geometry.uvRegion.y,mesh.geometry.uvRegion.z,mesh.geometry.uvRegion.w):"uTextureOffset"==uni.name&&mesh.material.textureMap?gl.uniform2f(uni.location,mesh.material.textureMap.offset.x,mesh.material.textureMap.offset.y):"uOpacity"==uni.name&&gl.uniform1f(uni.location,mesh.material.opacity)}}},{"./KTMain":20,"./KTMaterial":21,"./KTMatrix4":27}],23:[function(require,module){function MaterialLambert(textureMap,color,opacity){this.__ktmaterial=!0;var material=new Material({textureMap:textureMap,color:color,opacity:opacity,shader:KT.shaders.lambert});this.textureMap=material.textureMap,this.color=material.color,this.shader=material.shader,this.opacity=material.opacity,this.drawFaces=material.drawFaces,this.drawAs=material.drawAs,this.transparent=material.transparent}var Material=require("./KTMaterial"),Matrix4=require("./KTMatrix4");module.exports=MaterialLambert,MaterialLambert.prototype.sendAttribData=function(mesh){for(var gl=KT.gl,geometry=mesh.geometry,attributes=this.shader.attributes,i=0,len=attributes.length;len>i;i++){var att=attributes[i];"aVertexPosition"==att.name?(gl.bindBuffer(gl.ARRAY_BUFFER,geometry.vertexBuffer),gl.vertexAttribPointer(att.location,geometry.vertexBuffer.itemSize,gl.FLOAT,!1,0,0)):"aVertexColor"==att.name?(gl.bindBuffer(gl.ARRAY_BUFFER,geometry.colorsBuffer),gl.vertexAttribPointer(att.location,geometry.colorsBuffer.itemSize,gl.FLOAT,!1,0,0)):"aTextureCoord"==att.name?(gl.bindBuffer(gl.ARRAY_BUFFER,geometry.texBuffer),gl.vertexAttribPointer(att.location,geometry.texBuffer.itemSize,gl.FLOAT,!1,0,0)):"aVertexNormal"==att.name&&(gl.bindBuffer(gl.ARRAY_BUFFER,geometry.normalsBuffer),gl.vertexAttribPointer(att.location,geometry.normalsBuffer.itemSize,gl.FLOAT,!1,0,0))}return this},MaterialLambert.prototype.sendLightUniformData=function(light,uniform,modelTransformation){for(var gl=KT.gl,i=0,len=uniform.data.length;len>i;i++){var dat=uniform.data[i];if("position"==dat.name)light.__ktpointlight||light.__ktspotlight?gl.uniform3f(dat.location,light.position.x,light.position.y,light.position.z):gl.uniform3f(dat.location,0,0,0);else if("direction"==dat.name)light.__ktdirLight?gl.uniform3f(dat.location,light.direction.x,light.direction.y,light.direction.z):gl.uniform3f(dat.location,0,0,0);else if("spotDirection"==dat.name)light.__ktspotlight?gl.uniform3f(dat.location,light.direction.x,light.direction.y,light.direction.z):gl.uniform3f(dat.location,0,0,0);else if("color"==dat.name){var color=light.color.getRGB();gl.uniform3f(dat.location,color[0],color[1],color[2])}else if("intensity"==dat.name)gl.uniform1f(dat.location,light.intensity);else if("outerAngle"==dat.name)light.__ktspotlight?gl.uniform1f(dat.location,light.outerAngle):gl.uniform1f(dat.location,0);else if("innerAngle"==dat.name)light.__ktspotlight?gl.uniform1f(dat.location,light.innerAngle):gl.uniform1f(dat.location,0);else if("mvProjection"==dat.name)if(light.castShadow){var mvp=modelTransformation.clone().multiply(light.shadowCam.transformationMatrix).multiply(light.shadowCam.perspectiveMatrix).multiply(KT.lightNDCMat);gl.uniformMatrix4fv(dat.location,!1,mvp.toFloat32Array())}else gl.uniformMatrix4fv(dat.location,!1,Matrix4.getIdentity().toFloat32Array());else"castShadow"==dat.name?gl.uniform1i(dat.location,light.castShadow?1:0):"shadowStrength"==dat.name?gl.uniform1f(dat.location,light.shadowStrength):"lightMult"==dat.name&&gl.uniform1f(dat.location,light.__ktdirLight?-1:1)}},MaterialLambert.prototype.sendUniformData=function(mesh,camera,scene){for(var transformationMatrix,modelTransformation,gl=KT.gl,uniforms=(mesh.geometry,this.shader.uniforms),usedLightUniform=null,lightsCount=0,shadowMapsUniform=[],i=0,len=uniforms.length;len>i;i++){var uni=uniforms[i];if(uni.multi&&"Light"==uni.type){if(lightsCount==uni.data.length)continue;for(var lights=scene.lights,j=0,jlen=lights.length;jlen>j;j++)this.sendLightUniformData(lights[j],uni.data[lightsCount++],modelTransformation)}else if("uShadowMaps"==uni.type)shadowMapsUniform.push(uni);else if("uMVMatrix"==uni.name)modelTransformation=mesh.getTransformationMatrix(camera),transformationMatrix=modelTransformation.clone().multiply(camera.transformationMatrix),gl.uniformMatrix4fv(uni.location,!1,transformationMatrix.toFloat32Array());else if("uPMatrix"==uni.name)gl.uniformMatrix4fv(uni.location,!1,camera.perspectiveMatrix.toFloat32Array());else if("uMaterialColor"==uni.name){var color=mesh.material.color.getRGBA();gl.uniform4fv(uni.location,new Float32Array(color))}else if("uTextureSampler"==uni.name){if(mesh.material.textureMap){var tex=mesh.material.textureMap;tex.image&&!tex.image.ready&&(tex=KT.missingTexture),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,tex.texture),gl.uniform1i(uni.location,0)}}else if("uHasTexture"==uni.name)gl.uniform1i(uni.location,mesh.material.textureMap?1:0);else if("uUseLighting"==uni.name)gl.uniform1i(uni.location,scene.useLighting?1:0);else if("uNormalMatrix"==uni.name){var normalMatrix=modelTransformation.toMatrix3().inverse().toFloat32Array();gl.uniformMatrix3fv(uni.location,!1,normalMatrix)}else if("uModelMatrix"==uni.name)gl.uniformMatrix4fv(uni.location,!1,modelTransformation.toFloat32Array());else if("uAmbientLightColor"==uni.name&&scene.useLighting&&scene.ambientLight){var color=scene.ambientLight.getRGB();gl.uniform3f(uni.location,color[0],color[1],color[2])}else if("uOpacity"==uni.name)gl.uniform1f(uni.location,mesh.material.opacity);else if("uTextureRepeat"==uni.name&&mesh.material.textureMap){var repeat=mesh.material.repeat?mesh.material.repeat:mesh.material.textureMap.repeat;gl.uniform2f(uni.location,repeat.x,repeat.y)}else"uGeometryUV"==uni.name&&mesh.material.textureMap?gl.uniform4f(uni.location,mesh.geometry.uvRegion.x,mesh.geometry.uvRegion.y,mesh.geometry.uvRegion.z,mesh.geometry.uvRegion.w):"uTextureOffset"==uni.name&&mesh.material.textureMap?gl.uniform2f(uni.location,mesh.material.textureMap.offset.x,mesh.material.textureMap.offset.y):"uUsedLights"==uni.name?usedLightUniform=uni:"uReceiveShadow"==uni.name&&gl.uniform1i(uni.location,mesh.receiveShadow?1:0)}if(usedLightUniform&&gl.uniform1i(usedLightUniform.location,lightsCount),shadowMapsUniform&&shadowMapsUniform.length>0)for(var i=0;lightsCount>i;i++)lights[i].castShadow&&(gl.activeTexture(gl.TEXTURE10+i),gl.bindTexture(gl.TEXTURE_2D,lights[i].shadowBuffer.texture),gl.uniform1i(shadowMapsUniform[i].location,10+i));return this}},{"./KTMaterial":21,"./KTMatrix4":27}],24:[function(require,module){function MaterialPhong(textureMap,color,opacity){this.__ktmaterial=!0;var material=new Material({textureMap:textureMap,color:color,opacity:opacity,shader:KT.shaders.phong});this.textureMap=material.textureMap,this.specularMap=null,this.color=material.color,this.shader=material.shader,this.opacity=material.opacity,this.drawFaces=material.drawFaces,this.drawAs=material.drawAs,this.specularColor=new Color(Color._WHITE),this.shininess=0,this.transparent=material.transparent}var Material=require("./KTMaterial"),Color=require("./KTColor"),Matrix4=require("./KTMatrix4");module.exports=MaterialPhong,MaterialPhong.prototype.sendAttribData=function(mesh){for(var gl=KT.gl,geometry=mesh.geometry,attributes=this.shader.attributes,i=0,len=attributes.length;len>i;i++){var att=attributes[i];"aVertexPosition"==att.name?(gl.bindBuffer(gl.ARRAY_BUFFER,geometry.vertexBuffer),gl.vertexAttribPointer(att.location,geometry.vertexBuffer.itemSize,gl.FLOAT,!1,0,0)):"aVertexColor"==att.name?(gl.bindBuffer(gl.ARRAY_BUFFER,geometry.colorsBuffer),gl.vertexAttribPointer(att.location,geometry.colorsBuffer.itemSize,gl.FLOAT,!1,0,0)):"aTextureCoord"==att.name?(gl.bindBuffer(gl.ARRAY_BUFFER,geometry.texBuffer),gl.vertexAttribPointer(att.location,geometry.texBuffer.itemSize,gl.FLOAT,!1,0,0)):"aVertexNormal"==att.name&&(gl.bindBuffer(gl.ARRAY_BUFFER,geometry.normalsBuffer),gl.vertexAttribPointer(att.location,geometry.normalsBuffer.itemSize,gl.FLOAT,!1,0,0))}},MaterialPhong.prototype.sendLightUniformData=function(light,uniform,modelTransformation){for(var gl=KT.gl,i=0,len=uniform.data.length;len>i;i++){var dat=uniform.data[i];if("position"==dat.name)light.__ktpointlight||light.__ktspotlight?gl.uniform3f(dat.location,light.position.x,light.position.y,light.position.z):gl.uniform3f(dat.location,0,0,0);else if("direction"==dat.name)light.__ktdirLight?gl.uniform3f(dat.location,light.direction.x,light.direction.y,light.direction.z):gl.uniform3f(dat.location,0,0,0);else if("spotDirection"==dat.name)light.__ktspotlight?gl.uniform3f(dat.location,light.direction.x,light.direction.y,light.direction.z):gl.uniform3f(dat.location,0,0,0);else if("color"==dat.name){var color=light.color.getRGB();gl.uniform3f(dat.location,color[0],color[1],color[2])}else if("intensity"==dat.name)gl.uniform1f(dat.location,light.intensity);else if("outerAngle"==dat.name)light.__ktspotlight?gl.uniform1f(dat.location,light.outerAngle):gl.uniform1f(dat.location,0);else if("innerAngle"==dat.name)light.__ktspotlight?gl.uniform1f(dat.location,light.innerAngle):gl.uniform1f(dat.location,0);else if("mvProjection"==dat.name)if(light.castShadow){var mvp=modelTransformation.clone().multiply(light.shadowCam.transformationMatrix).multiply(light.shadowCam.perspectiveMatrix).multiply(KT.lightNDCMat);gl.uniformMatrix4fv(dat.location,!1,mvp.toFloat32Array())}else gl.uniformMatrix4fv(dat.location,!1,Matrix4.getIdentity().toFloat32Array());else"castShadow"==dat.name?gl.uniform1i(dat.location,light.castShadow?1:0):"shadowStrength"==dat.name?gl.uniform1f(dat.location,light.shadowStrength):"lightMult"==dat.name&&gl.uniform1f(dat.location,light.__ktdirLight?-1:1)}},MaterialPhong.prototype.sendUniformData=function(mesh,camera,scene){for(var transformationMatrix,modelTransformation,gl=KT.gl,uniforms=(mesh.geometry,this.shader.uniforms),lights=scene.lights,lightsCount=0,usedLightUniform=null,shadowMapsUniform=[],i=0,len=uniforms.length;len>i;i++){var uni=uniforms[i];if(uni.multi&&"Light"==uni.type){if(lightsCount==uni.data.length)continue;for(var j=0,jlen=lights.length;jlen>j;j++)this.sendLightUniformData(lights[j],uni.data[lightsCount++],modelTransformation)}else if("uShadowMaps"==uni.type)shadowMapsUniform.push(uni);else if("uMVMatrix"==uni.name)modelTransformation=mesh.getTransformationMatrix(camera),transformationMatrix=modelTransformation.clone().multiply(camera.transformationMatrix),gl.uniformMatrix4fv(uni.location,!1,transformationMatrix.toFloat32Array());else if("uPMatrix"==uni.name)gl.uniformMatrix4fv(uni.location,!1,camera.perspectiveMatrix.toFloat32Array());else if("uMaterialColor"==uni.name){var color=mesh.material.color.getRGBA();gl.uniform4fv(uni.location,new Float32Array(color))}else if("uTextureSampler"==uni.name){if(mesh.material.textureMap){var tex=mesh.material.textureMap;tex.image&&!tex.image.ready&&(tex=KT.missingTexture),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,tex.texture),gl.uniform1i(uni.location,0)}}else if("uHasTexture"==uni.name)gl.uniform1i(uni.location,mesh.material.textureMap?1:0);else if("uUseLighting"==uni.name)gl.uniform1i(uni.location,scene.useLighting?1:0);else if("uReceiveShadow"==uni.name)gl.uniform1i(uni.location,mesh.receiveShadow?1:0);else if("uNormalMatrix"==uni.name){var normalMatrix=modelTransformation.toMatrix3().inverse().toFloat32Array();gl.uniformMatrix3fv(uni.location,!1,normalMatrix)}else if("uModelMatrix"==uni.name)gl.uniformMatrix4fv(uni.location,!1,modelTransformation.toFloat32Array());else if("uCameraPosition"==uni.name)gl.uniform3f(uni.location,camera.position.x,camera.position.y,camera.position.z);else if("uSpecularColor"==uni.name){var color=this.specularColor.getRGB();gl.uniform3f(uni.location,color[0],color[1],color[2])}else if("uShininess"==uni.name)gl.uniform1f(uni.location,this.shininess);else if("uAmbientLightColor"==uni.name&&scene.useLighting&&scene.ambientLight){var color=scene.ambientLight.getRGB();gl.uniform3f(uni.location,color[0],color[1],color[2])}else if("uOpacity"==uni.name)gl.uniform1f(uni.location,mesh.material.opacity);else if("uTextureRepeat"==uni.name&&mesh.material.textureMap){var repeat=mesh.material.repeat?mesh.material.repeat:mesh.material.textureMap.repeat;gl.uniform2f(uni.location,repeat.x,repeat.y)}else"uGeometryUV"==uni.name&&mesh.material.textureMap?gl.uniform4f(uni.location,mesh.geometry.uvRegion.x,mesh.geometry.uvRegion.y,mesh.geometry.uvRegion.z,mesh.geometry.uvRegion.w):"uTextureOffset"==uni.name&&mesh.material.textureMap?gl.uniform2f(uni.location,mesh.material.textureMap.offset.x,mesh.material.textureMap.offset.y):"uUsedLights"==uni.name?usedLightUniform=uni:"uUseSpecularMap"==uni.name?gl.uniform1i(uni.location,mesh.material.specularMap?1:0):"uSpecularMapSampler"==uni.name&&mesh.material.specularMap&&(gl.activeTexture(gl.TEXTURE1),gl.bindTexture(gl.TEXTURE_2D,mesh.material.specularMap.texture),gl.uniform1i(uni.location,1))}if(usedLightUniform&&gl.uniform1i(usedLightUniform.location,lightsCount),shadowMapsUniform&&shadowMapsUniform.length>0)for(var i=0;lightsCount>i;i++)lights[i].castShadow&&(gl.activeTexture(gl.TEXTURE10+i),gl.bindTexture(gl.TEXTURE_2D,lights[i].shadowBuffer.texture),gl.uniform1i(shadowMapsUniform[i].location,10+i))}},{"./KTColor":5,"./KTMaterial":21,"./KTMatrix4":27}],25:[function(require,module){module.exports={radDegRel:Math.PI/180,PI_2:Math.PI/2,PI:Math.PI,PI3_2:3*Math.PI/2,PI2:2*Math.PI,degToRad:function(degrees){return degrees*this.radDegRel},radToDeg:function(radians){return radians/this.radDegRel},get2DAngle:function(x1,y1,x2,y2){var xx=x2-x1,yy=y1-y2,ang=(Math.atan2(yy,xx)+this.PI2)%this.PI2;return ang}}},{}],26:[function(require,module){function Matrix3(){if(9!=arguments.length)throw"Matrix 3 must receive 9 parameters";for(var c=0,i=0;9>i;i+=3)this[c]=arguments[i],this[c+3]=arguments[i+1],this[c+6]=arguments[i+2],c+=1;return this.__ktmt3=!0,this}module.exports=Matrix3,Matrix3.prototype.getDeterminant=function(){var T=this,det=T[0]*T[4]*T[8]+T[1]*T[5]*T[6]+T[2]*T[3]*T[7]-T[6]*T[4]*T[2]-T[7]*T[5]*T[0]-T[8]*T[3]*T[1];return det},Matrix3.prototype.inverse=function(){var det=this.getDeterminant();if(0==det)return null;var T=this,inv=new Matrix3(T[4]*T[8]-T[5]*T[7],T[5]*T[6]-T[3]*T[8],T[3]*T[7]-T[4]*T[6],T[2]*T[7]-T[1]*T[8],T[0]*T[8]-T[2]*T[6],T[1]*T[6]-T[0]*T[7],T[1]*T[5]-T[2]*T[4],T[2]*T[3]-T[0]*T[5],T[0]*T[4]-T[1]*T[3]);return inv.multiply(1/det),this.copy(inv),this},Matrix3.prototype.multiply=function(number){for(var T=this,i=0;9>i;i++)T[i]*=number;return this},Matrix3.prototype.copy=function(matrix3){if(!matrix3.__ktmt3)throw"Can only copy a matrix3 into another";for(var T=this,i=0;9>i;i++)T[i]=matrix3[i];return this},Matrix3.prototype.transpose=function(){for(var T=this,values=[T[0],T[3],T[6],T[1],T[4],T[7],T[2],T[5],T[8]],i=0;9>i;i++)T[i]=values[i];return this},Matrix3.prototype.toFloat32Array=function(){var T=this;return new Float32Array([T[0],T[1],T[2],T[3],T[4],T[5],T[6],T[7],T[8]])}},{}],27:[function(require,module){function Matrix4(){if(16!=arguments.length)throw"Matrix 4 must receive 16 parameters";for(var c=0,i=0;16>i;i+=4)this[c]=arguments[i],this[c+4]=arguments[i+1],this[c+8]=arguments[i+2],this[c+12]=arguments[i+3],c+=1;return this.__ktm4=!0,this}var Matrix3=require("./KTMatrix3");module.exports=Matrix4,Matrix4.prototype.identity=function(){for(var params=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],c=0,i=0;16>i;i+=4)this[c]=params[i],this[c+4]=params[i+1],this[c+8]=params[i+2],this[c+12]=params[i+3],c+=1;return this},Matrix4.prototype.multiplyScalar=function(number){for(var T=this,i=0;16>i;i++)T[i]*=number;return this},Matrix4.prototype.multiply=function(matrix4){if(matrix4.__ktm4){var A1=[this[0],this[1],this[2],this[3]],A2=[this[4],this[5],this[6],this[7]],A3=[this[8],this[9],this[10],this[11]],A4=[this[12],this[13],this[14],this[15]],B1=[matrix4[0],matrix4[4],matrix4[8],matrix4[12]],B2=[matrix4[1],matrix4[5],matrix4[9],matrix4[13]],B3=[matrix4[2],matrix4[6],matrix4[10],matrix4[14]],B4=[matrix4[3],matrix4[7],matrix4[11],matrix4[15]],dot=function(col,row){for(var sum=0,j=0;4>j;j++)sum+=row[j]*col[j];return sum};return this[0]=dot(A1,B1),this[1]=dot(A1,B2),this[2]=dot(A1,B3),this[3]=dot(A1,B4),this[4]=dot(A2,B1),this[5]=dot(A2,B2),this[6]=dot(A2,B3),this[7]=dot(A2,B4),this[8]=dot(A3,B1),this[9]=dot(A3,B2),this[10]=dot(A3,B3),this[11]=dot(A3,B4),this[12]=dot(A4,B1),this[13]=dot(A4,B2),this[14]=dot(A4,B3),this[15]=dot(A4,B4),this}if(4==matrix4.length){for(var ret=[],col=matrix4,i=0;4>i;i+=1){for(var row=[this[i],this[i+4],this[i+8],this[i+12]],sum=0,j=0;4>j;j++)sum+=row[j]*col[j];ret.push(sum)}return ret}throw"Invalid constructor"},Matrix4.prototype.transpose=function(){for(var T=this,values=[T[0],T[4],T[8],T[12],T[1],T[5],T[9],T[13],T[2],T[6],T[10],T[14],T[3],T[7],T[11],T[15]],i=0;16>i;i++)this[i]=values[i];return this},Matrix4.prototype.copy=function(matrix4){if(!matrix4.__ktm4)throw"Can only copy a Matrix4 into this matrix";for(var i=0;16>i;i++)this[i]=matrix4[i];return this},Matrix4.prototype.clone=function(){var T=this;return new Matrix4(T[0],T[4],T[8],T[12],T[1],T[5],T[9],T[13],T[2],T[6],T[10],T[14],T[3],T[7],T[11],T[15])
},Matrix4.prototype.toFloat32Array=function(){var T=this;return new Float32Array([T[0],T[1],T[2],T[3],T[4],T[5],T[6],T[7],T[8],T[9],T[10],T[11],T[12],T[13],T[14],T[15]])},Matrix4.prototype.toMatrix3=function(){var T=this;return new Matrix3(T[0],T[1],T[2],T[4],T[5],T[6],T[8],T[9],T[10])},Matrix4.getIdentity=function(){return new Matrix4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},Matrix4.getXRotation=function(radians){var C=Math.cos(radians),S=Math.sin(radians);return new Matrix4(1,0,0,0,0,C,S,0,0,-S,C,0,0,0,0,1)},Matrix4.getYRotation=function(radians){var C=Math.cos(radians),S=Math.sin(radians);return new Matrix4(C,0,S,0,0,1,0,0,-S,0,C,0,0,0,0,1)},Matrix4.getZRotation=function(radians){var C=Math.cos(radians),S=Math.sin(radians);return new Matrix4(C,S,0,0,-S,C,0,0,0,0,1,0,0,0,0,1)},Matrix4.getTranslation=function(vector3){if(!vector3.__ktv3)throw"Can only translate to a vector 3";var x=vector3.x,y=vector3.y,z=vector3.z;return new Matrix4(1,0,0,x,0,1,0,y,0,0,1,z,0,0,0,1)},Matrix4.getScale=function(vector3){if(!vector3.__ktv3)throw"Can only scale to a vector 3";var sx=vector3.x,sy=vector3.y,sz=vector3.z;return new Matrix4(sx,0,0,0,0,sy,0,0,0,0,sz,0,0,0,0,1)},Matrix4.getTransformation=function(position,rotation,scale,stack){if(!position.__ktv3)throw"Position must be a Vector3";if(!rotation.__ktv3)throw"Rotation must be a Vector3";if(scale&&!scale.__ktv3)throw"Scale must be a Vector3";stack||(stack="SRxRyRzT");var matrix,ss=-1!=stack.indexOf("S"),rx=-1!=stack.indexOf("Rx"),ry=-1!=stack.indexOf("Ry"),rz=-1!=stack.indexOf("Rz"),tt=-1!=stack.indexOf("T"),scale=scale&&ss?Matrix4.getScale(scale):Matrix4.getIdentity(),rotationX=Matrix4.getXRotation(rotation.x),rotationY=Matrix4.getYRotation(rotation.y),rotationZ=Matrix4.getZRotation(rotation.z),translation=Matrix4.getTranslation(position);return matrix=scale,rx&&matrix.multiply(rotationX),ry&&matrix.multiply(rotationY),rz&&matrix.multiply(rotationZ),tt&&matrix.multiply(translation),matrix},Matrix4.clearToSphericalBillboard=function(matrix4){if(!matrix4.__ktm4)throw"Can only transform a matrix 4";for(var ret=matrix4.clone(),i=0;3>i;i++)for(var j=0;3>j;j++)ret[4*i+j]=0;return ret[0]=1,ret[5]=1,ret[10]=1,ret}},{"./KTMatrix3":26}],28:[function(require,module){function Mesh(geometry,material){if(!geometry||!geometry.__ktgeometry)throw"Geometry must be a KTGeometry instance";if(!material||!material.__ktmaterial)throw"Material must be a KTMaterial instance";this.__ktmesh=!0,this.geometry=geometry,this.material=material,this.isBillboard=geometry instanceof GeometryBillboard,this.parent=null,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.position=new Vector3(0,0,0),this.rotation=new Vector3(0,0,0),this.scale=new Vector3(1,1,1),this.previousPosition=this.position.clone(),this.previousRotation=this.rotation.clone(),this.previousScale=this.scale.clone(),this.transformationMatrix=null,this.transformationStack="SRxRyRzT"}var Matrix4=require("./KTMatrix4"),Vector3=(require("./KTVector2"),require("./KTVector3")),KTMath=require("./KTMath"),GeometryBillboard=require("./KTGeometryBillboard");module.exports=Mesh,Mesh.prototype.lookAtObject=function(camera){var angle=KTMath.get2DAngle(this.position.x,this.position.z,camera.position.x,camera.position.z)+KTMath.PI_2;if(this.rotation.y=angle,this.geometry.spherical){var dist=new Vector3(camera.position.x-this.position.x,0,camera.position.z-this.position.z).length(),xAng=-KTMath.get2DAngle(0,this.position.y,dist,camera.position.y);this.rotation.x=xAng}},Mesh.prototype.getTransformationMatrix=function(camera){if(this.isBillboard&&this.lookAtObject(camera),!(this.transformationMatrix&&this.position.equals(this.previousPosition)&&this.rotation.equals(this.previousRotation)&&this.scale.equals(this.previousScale))&&(this.transformationMatrix=Matrix4.getTransformation(this.position,this.rotation,this.scale,this.transformationStack),this.previousPosition.copy(this.position),this.previousRotation.copy(this.rotation),this.previousScale.copy(this.scale),this.parent)){var m=this.parent.getTransformationMatrix();this.transformationMatrix.multiply(m)}return this.transformationMatrix.clone()}},{"./KTGeometryBillboard":8,"./KTMath":25,"./KTMatrix4":27,"./KTVector2":38,"./KTVector3":39}],29:[function(require,module){function MeshSprite(width,height,textureSrc){this.__ktmesh=!0,this.texture=null,textureSrc&&(this.texture=textureSrc.__kttexture||textureSrc.__kttextureframebuffer?textureSrc:new Texture(textureSrc)),this.geometry=new GeometryGUITexture(width,height),this.material=new MaterialBasic(this.texture,"#FFFFFF"),this.material.transparent=!0,this.parent=null,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.position=new Vector3(0,0,0),this.rotation=new Vector3(0,0,0),this.scale=new Vector3(1,1,1),this.previousPosition=this.position.clone(),this.previousRotation=this.rotation.clone(),this.previousScale=this.scale.clone(),this.transformationMatrix=null,this.transformationStack="SRzT"}var GeometryGUITexture=(require("./KTColor"),require("./KTMain"),require("./KTGeometryGUITexture")),Texture=require("./KTTexture"),MaterialBasic=require("./KTMaterialBasic"),Vector3=require("./KTVector3"),Matrix4=require("./KTMatrix4");module.exports=MeshSprite,MeshSprite.prototype.getTransformationMatrix=function(){if(!(this.transformationMatrix&&this.position.equals(this.previousPosition)&&this.rotation.equals(this.previousRotation)&&this.scale.equals(this.previousScale))&&(this.transformationMatrix=Matrix4.getTransformation(this.position,this.rotation,this.scale,this.transformationStack),this.previousPosition.copy(this.position),this.previousRotation.copy(this.rotation),this.previousScale.copy(this.scale),this.parent)){var m=this.parent.getTransformationMatrix();this.transformationMatrix.multiply(m)}return this.transformationMatrix.clone()}},{"./KTColor":5,"./KTGeometryGUITexture":11,"./KTMain":20,"./KTMaterialBasic":22,"./KTMatrix4":27,"./KTTexture":33,"./KTVector3":39}],30:[function(require,module){function OrbitAndPan(target){this.__ktCamCtrls=!0,this.camera=null,this.lastDrag=null,this.lastPan=null,this.target=target?target:new Vector3(0,0,0),this.angle=new Vector2(0,0),this.zoom=1,this.sensitivity=new Vector2(.5,.5)}var Vector2=require("./KTVector2"),Vector3=require("./KTVector3"),Input=require("./KTInput"),KTMath=require("./KTMath");module.exports=OrbitAndPan,OrbitAndPan.prototype.update=function(){if(!this.camera.locked){if(Input.isWheelMoved(Input.vMouse.WHEELUP)?(this.zoom-=.3,this.setCameraPosition()):Input.isWheelMoved(Input.vMouse.WHEELDOWN)&&(this.zoom+=.3,this.setCameraPosition()),Input.isMouseDown(Input.vMouse.LEFT)){null==this.lastDrag&&(this.lastDrag=Input._mouse.position.clone());var dx=Input._mouse.position.x-this.lastDrag.x,dy=Input._mouse.position.y-this.lastDrag.y;(0!=dx||0!=dy)&&(this.angle.x-=KTMath.degToRad(dx*this.sensitivity.x),this.angle.y-=KTMath.degToRad(dy*this.sensitivity.y),this.setCameraPosition()),this.lastDrag.copy(Input._mouse.position)}else this.lastDrag=null;if(Input.isMouseDown(Input.vMouse.RIGHT)){null==this.lastPan&&(this.lastPan=Input._mouse.position.clone());var dx=Input._mouse.position.x-this.lastPan.x,dy=Input._mouse.position.y-this.lastPan.y;if(0!=dx||0!=dy){{var theta=-this.angle.y,ang=-this.angle.x-KTMath.PI_2,cos=Math.cos(ang),sin=Math.sin(ang),cosT=Math.cos(theta);Math.sin(theta)}this.target.x-=cos*dx*this.sensitivity.x/10,this.target.y+=cosT*dy*this.sensitivity.y/10,this.target.z-=sin*dx*this.sensitivity.x/10,this.setCameraPosition()}this.lastPan.copy(Input._mouse.position)}else this.lastPan=null}},OrbitAndPan.prototype.setCameraPosition=function(){this.angle.x=(this.angle.x+KTMath.PI2)%KTMath.PI2,this.angle.y=(this.angle.y+KTMath.PI2)%KTMath.PI2,this.angle.y<KTMath.PI&&this.angle.y>=KTMath.PI_2&&(this.angle.y=KTMath.degToRad(89.9)),this.angle.y>KTMath.PI&&this.angle.y<=KTMath.PI3_2&&(this.angle.y=KTMath.degToRad(270.9)),this.zoom<=.3&&(this.zoom=.3);var cosT=Math.cos(this.angle.y),sinT=Math.sin(this.angle.y),x=this.target.x+Math.cos(this.angle.x)*cosT*this.zoom,y=this.target.y+sinT*this.zoom,z=this.target.z-Math.sin(this.angle.x)*cosT*this.zoom;this.camera.position.set(x,y,z),this.camera.lookAt(this.target)},OrbitAndPan.prototype.setCamera=function(camera){var zoom=Vector3.vectorsDifference(camera.position,this.target).length();this.camera=camera,this.zoom=zoom,this.angle.x=KTMath.get2DAngle(this.target.x,this.target.z,camera.position.x,camera.position.z),this.angle.y=KTMath.get2DAngle(0,camera.position.y,zoom,this.target.y),this.setCameraPosition()}},{"./KTInput":16,"./KTMath":25,"./KTVector2":38,"./KTVector3":39}],31:[function(require,module){function Scene(params){this.__ktscene=!0,this.meshes=[],this.lights=[],this.shadingMode=["BASIC","LAMBERT"],params||(params={}),this.useLighting=params.useLighting?!0:!1,this.ambientLight=params.ambientLight?new Color(params.ambientLight):null,this.setShadowMaterial()}var KT=require("./KTMain"),Color=require("./KTColor"),Material=require("./KTMaterial"),GeometrySkybox=(require("./KTMaterialBasic"),require("./KTMatrix4"),require("./KTGeometrySkybox"));module.exports=Scene,Scene.prototype.setShadowMaterial=function(){var T=this;this.shadowMapping=null,this.shadowMat=new Material({shader:KT.shaders.depth,sendAttribData:function(mesh){for(var gl=KT.gl,geometry=mesh.geometry,attributes=this.shader.attributes,i=0,len=attributes.length;len>i;i++){var att=attributes[i];"aVertexPosition"==att.name&&(gl.bindBuffer(gl.ARRAY_BUFFER,geometry.vertexBuffer),gl.vertexAttribPointer(att.location,geometry.vertexBuffer.itemSize,gl.FLOAT,!1,0,0))}},sendUniformData:function(mesh,camera){for(var gl=KT.gl,uniforms=this.shader.uniforms,i=0,len=uniforms.length;len>i;i++){var uni=uniforms[i];if("uMVPMatrix"==uni.name){var mvp=mesh.getTransformationMatrix(camera).multiply(camera.transformationMatrix).multiply(camera.perspectiveMatrix);gl.uniformMatrix4fv(uni.location,!1,mvp.toFloat32Array())}else"uDepthMult"==uni.name&&gl.uniform1f(uni.location,T.shadowMapping.__ktdirLight?-1:1)}}})},Scene.prototype.add=function(object){if(object.__ktmesh)this.meshes.push(object);else{if(!(object.__ktdirLight||object.__ktpointlight||object.__ktspotlight))throw"Can't add the object to the scene";this.lights.push(object)}return this},Scene.prototype.drawMesh=function(mesh,camera){if(mesh.geometry.ready&&(!this.shadowMapping||mesh.castShadow)){var gl=KT.gl,material=this.shadowMapping?this.shadowMat:mesh.material,shader=material.shader;KT.switchProgram(shader),this.setMaterialAttributes(mesh.material),mesh.geometry.autoUpdate&&mesh.geometry.updateGeometry(),material.sendAttribData(mesh,camera,this),material.sendUniformData(mesh,camera,this),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,mesh.geometry.facesBuffer),gl.drawElements(gl[material.drawAs],mesh.geometry.facesBuffer.numItems,gl.UNSIGNED_SHORT,0)}},Scene.prototype.clear=function(){KT.gl.clear(KT.gl.COLOR_BUFFER_BIT|KT.gl.DEPTH_BUFFER_BIT)},Scene.prototype.renderToFramebuffer=function(camera,framebuffer){if(!framebuffer.__kttextureframebuffer)throw"framebuffer must be an instance of TextureFramebuffer";var gl=KT.gl;gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer.framebuffer),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.clearColor(1,1,1,1),gl.viewport(0,0,framebuffer.width,framebuffer.height),this.render(camera),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.viewport(0,0,gl.width,gl.height)},Scene.prototype.render=function(camera){var gl=KT.gl;if(!this.shadowMapping){if(KT.modules.shadowMapping)for(var i=0,len=this.lights.length-1;len>=i;i++)this.lights[i].castShadow&&(this.shadowMapping=this.lights[i],this.renderToFramebuffer(this.lights[i].shadowCam,this.lights[i].shadowBuffer)),i==len&&(this.shadowMapping=null);camera.controls&&camera.controls.update()}gl.disable(gl.BLEND);for(var transparents=[],i=0,len=this.meshes.length;len>i;i++){var mesh=this.meshes[i];mesh.visible&&0!=mesh.material.opacity&&(1!=mesh.material.opacity||mesh.material.transparent?transparents.push(mesh):this.drawMesh(mesh,camera))}!this.shadowMapping&&camera.skybox&&this.drawSkybox(camera.skybox,camera),gl.enable(gl.BLEND);for(var i=0,len=transparents.length;len>i;i++){var mesh=transparents[i];this.drawMesh(mesh,camera)}return this},Scene.prototype.drawSkybox=function(skybox,camera){var gl=KT.gl;KT.switchProgram(GeometrySkybox.material.shader),gl.enable(gl.CULL_FACE),gl.cullFace(gl.FRONT),gl.depthFunc(gl.LEQUAL),skybox.render(camera,this),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,skybox.boxGeo.facesBuffer),gl.drawElements(gl.TRIANGLES,skybox.boxGeo.facesBuffer.numItems,gl.UNSIGNED_SHORT,0)},Scene.prototype.setMaterialAttributes=function(material){var gl=KT.gl,cull="BACK";"BACK"==material.drawFaces?cull="FRONT":"BOTH"==material.drawFaces&&(cull=""),""!=cull?(gl.enable(gl.CULL_FACE),gl.cullFace(gl[cull])):gl.disable(gl.CULL_FACE)}},{"./KTColor":5,"./KTGeometrySkybox":13,"./KTMain":20,"./KTMaterial":21,"./KTMaterialBasic":22,"./KTMatrix4":27}],32:[function(require,module){var structs={Light:"struct Light{ lowp vec3 position; lowp vec3 color; lowp vec3 direction; lowp vec3 spotDirection; lowp float intensity; lowp float innerAngle; lowp float outerAngle; lowp float shadowStrength; lowp float lightMult; bool castShadow; mediump mat4 mvProjection; }; "},functions={calcShadowFactor:"lowp float calcShadowFactor(sampler2D shadowMap, mediump vec4 lightSpacePos, lowp float shadowStrength, lowp float lightMult){ if (!uReceiveShadow) return 1.0; mediump vec3 projCoords = lightSpacePos.xyz / lightSpacePos.w; mediump vec2 UVCoords; UVCoords.x = projCoords.x; UVCoords.y = projCoords.y; projCoords.z *= lightMult; bvec4 inTexture = bvec4(UVCoords.x >= 0.0, UVCoords.y >= 0.0, UVCoords.x < 1.0, UVCoords.y < 1.0); if (!all(inTexture)) return 1.0; mediump float z = (1.0 - projCoords.z) * 15.0; if (lightMult == 1.0) z = 1.0 - z; z = min(z, 1.0); mediump vec4 texCoord = texture2D(shadowMap, UVCoords);mediump float depth = texCoord.x; if (depth < (z - 0.005)) return shadowStrength; return 1.0; } ",setLightPosition:"void setLightPosition(int index, mediump vec4 position){ if (index == 0){ vLightPosition[0] = position; return; }if (index == 1){ vLightPosition[1] = position; return; }if (index == 2){ vLightPosition[2] = position; return; }if (index == 3){ vLightPosition[3] = position; return; }} ",getLightPosition:"mediump vec4 getLightPosition(int index){ if (index == 0){ return vLightPosition[0]; }if (index == 1){ return vLightPosition[1]; }if (index == 2){ return vLightPosition[2]; }if (index == 3){ return vLightPosition[3]; }return vec4(0.0); } ",getLightWeight:"mediump vec3 getLightWeight(mediump vec3 normal, mediump vec3 direction, lowp vec3 color, lowp float intensity){ mediump float lightDot = max(dot(normal, direction), 0.0); mediump vec3 lightWeight = (color * lightDot * intensity); return lightWeight; }"};module.exports={basic:{vertexShader:"attribute mediump vec2 aTextureCoord; attribute mediump vec3 aVertexPosition; attribute lowp vec4 aVertexColor; uniform mediump mat4 uMVPMatrix; uniform lowp vec4 uMaterialColor; varying mediump vec4 vVertexColor; varying mediump vec2 vTextureCoord;void main(void){ gl_Position = uMVPMatrix * vec4(aVertexPosition, 1.0); vVertexColor = aVertexColor * uMaterialColor; vTextureCoord = aTextureCoord; } ",fragmentShader:"uniform sampler2D uTextureSampler; uniform bool uHasTexture; uniform lowp vec2 uTextureRepeat; uniform lowp vec2 uTextureOffset; uniform mediump vec4 uGeometryUV; uniform lowp float uOpacity; varying mediump vec2 vTextureCoord; varying mediump vec4 vVertexColor; void main(void){ mediump vec4 color = vVertexColor; if (uHasTexture){ mediump float tx = uGeometryUV.x + mod(uTextureOffset.x + vTextureCoord.s * uTextureRepeat.x - uGeometryUV.x, uGeometryUV.z - uGeometryUV.x);mediump float ty = uGeometryUV.y + mod(uTextureOffset.y + vTextureCoord.t * uTextureRepeat.y - uGeometryUV.y, uGeometryUV.w - uGeometryUV.y);mediump vec4 texColor = texture2D(uTextureSampler, vec2(tx, ty)); color *= texColor; } gl_FragColor = vec4(color.rgb, color.a * uOpacity);}"},lambert:{vertexShader:structs.Light+"attribute mediump vec2 aTextureCoord; attribute mediump vec3 aVertexPosition; attribute lowp vec4 aVertexColor; attribute mediump vec3 aVertexNormal; uniform mediump mat4 uMVMatrix; uniform mediump mat4 uPMatrix; uniform lowp vec4 uMaterialColor; uniform mediump mat4 uModelMatrix; uniform mediump mat3 uNormalMatrix; uniform lowp vec3 uAmbientLightColor; uniform Light uLights[8]; uniform lowp int uUsedLights; uniform bool uUseLighting; varying mediump vec4 vVertexColor; varying mediump vec2 vTextureCoord;varying mediump vec3 vLightWeight; #kt_require(shadowmap_vert_in) "+functions.getLightWeight+"void main(void){ vec4 modelViewPosition = uMVMatrix * vec4(aVertexPosition, 1.0); gl_Position = uPMatrix * modelViewPosition; vLightWeight = uAmbientLightColor; if (uUseLighting){ vec3 vertexModelPosition = (uModelMatrix * vec4(aVertexPosition, 1.0)).xyz; lowp int shadowIndex = 0; for (int i=0;i<8;i++){ if (i >= uUsedLights){break; }Light l = uLights[i]; mediump vec3 lPos = l.position - vertexModelPosition;mediump float lDistance = length(lPos) / 2.0; if (length(l.position) == 0.0){ lDistance = 1.0; lPos = vec3(0.0); } mediump vec3 lightDirection = l.direction + normalize(lPos); lowp float spotWeight = 1.0; if (length(l.spotDirection) != 0.0){ lowp float cosAngle = dot(l.spotDirection, lightDirection); spotWeight = clamp((cosAngle - l.outerAngle) / (l.innerAngle - l.outerAngle), 0.0, 1.0); lDistance = 1.0; } vLightWeight += getLightWeight(aVertexNormal, lightDirection, l.color, l.intensity) * spotWeight / lDistance; #kt_require(shadowmap_vert_main) } } vVertexColor = aVertexColor * uMaterialColor; vTextureCoord = aTextureCoord; } ",fragmentShader:structs.Light+"uniform bool uUseLighting; uniform lowp int uUsedLights; uniform Light uLights[8]; uniform sampler2D uTextureSampler; uniform bool uHasTexture; uniform lowp float uOpacity; uniform lowp vec2 uTextureRepeat; uniform lowp vec2 uTextureOffset; uniform mediump vec4 uGeometryUV; varying mediump vec2 vTextureCoord; varying mediump vec4 vVertexColor; varying mediump vec3 vLightWeight; #kt_require(shadowmap_frag_in) void main(void){ mediump vec4 color = vVertexColor; if (uHasTexture){ mediump float tx = uGeometryUV.x + mod(uTextureOffset.x + vTextureCoord.s * uTextureRepeat.x - uGeometryUV.x, uGeometryUV.z - uGeometryUV.x);mediump float ty = uGeometryUV.y + mod(uTextureOffset.y + vTextureCoord.t * uTextureRepeat.y - uGeometryUV.y, uGeometryUV.w - uGeometryUV.y);mediump vec4 texColor = texture2D(uTextureSampler, vec2(tx, ty)); color *= texColor; } mediump vec3 lightWeight = vLightWeight; if (uUseLighting){ lowp int shadowIndex = 0; for (int i=0;i<8;i++){ Light l = uLights[i]; if (i >= uUsedLights){break; }lowp float shadowWeight = 1.0; #kt_require(shadowmap_frag_main) lightWeight *= shadowWeight; } } color.rgb *= lightWeight; gl_FragColor = vec4(color.rgb, color.a * uOpacity); }"},phong:{vertexShader:structs.Light+"attribute mediump vec2 aTextureCoord; attribute mediump vec3 aVertexPosition; attribute lowp vec4 aVertexColor; attribute mediump vec3 aVertexNormal; uniform mediump mat4 uMVMatrix; uniform mediump mat4 uPMatrix; uniform mediump mat4 uModelMatrix; uniform mediump mat3 uNormalMatrix; uniform lowp vec4 uMaterialColor; uniform lowp vec3 uAmbientLightColor; uniform bool uUseLighting; uniform lowp int uUsedLights; uniform Light uLights[8]; varying mediump vec4 vVertexColor; varying mediump vec2 vTextureCoord;varying mediump vec3 vLightWeight; varying mediump vec3 vNormal; varying mediump vec3 vPosition; #kt_require(shadowmap_vert_in) void main(void){ vec4 modelViewPosition = uMVMatrix * vec4(aVertexPosition, 1.0); gl_Position = uPMatrix * modelViewPosition; if (uUseLighting){ vNormal = uNormalMatrix * aVertexNormal; vLightWeight = uAmbientLightColor; int shadowIndex = 0; for (int i=0;i<8;i++){ if (i >= uUsedLights) break; #kt_require(shadowmap_vert_main) } }else{ vLightWeight = vec3(1.0); }vPosition = (uModelMatrix * vec4(aVertexPosition, 1.0)).xyz; vVertexColor = aVertexColor * uMaterialColor; vTextureCoord = aTextureCoord; } ",fragmentShader:structs.Light+"uniform bool uUseLighting; uniform lowp int uUsedLights; uniform Light uLights[8]; uniform bool uHasTexture; uniform sampler2D uTextureSampler; uniform lowp float uOpacity; uniform lowp vec2 uTextureRepeat; uniform lowp vec2 uTextureOffset; uniform lowp float uShininess; uniform mediump vec4 uGeometryUV; uniform mediump vec3 uCameraPosition; varying mediump vec2 vTextureCoord; varying mediump vec4 vVertexColor; varying mediump vec3 vLightWeight; varying mediump vec3 vNormal; varying mediump vec3 vPosition; #kt_require(specular_in) #kt_require(shadowmap_frag_in) "+functions.getLightWeight+"void main(void){ mediump vec4 color = vVertexColor; mediump vec3 normal = normalize(vNormal); mediump vec3 cameraDirection = normalize(uCameraPosition); mediump float tx; mediump float ty; if (uHasTexture){ tx = uGeometryUV.x + mod(uTextureOffset.x + vTextureCoord.s * uTextureRepeat.x - uGeometryUV.x, uGeometryUV.z - uGeometryUV.x);ty = uGeometryUV.y + mod(uTextureOffset.y + vTextureCoord.t * uTextureRepeat.y - uGeometryUV.y, uGeometryUV.w - uGeometryUV.y);mediump vec4 texColor = texture2D(uTextureSampler, vec2(tx, ty)); color *= texColor; } mediump vec3 phongLightWeight = vec3(0.0); if (uUseLighting){ int shadowIndex = 0; for (int i=0;i<8;i++){ if (i >= uUsedLights) break; Light l = uLights[i]; mediump vec3 lPos = l.position - vPosition;mediump float lDistance = length(lPos) / 2.0; if (length(l.position) == 0.0){ lDistance = 1.0; lPos = vec3(0.0); } mediump vec3 lightDirection = l.direction + normalize(lPos); lowp float spotWeight = 1.0; if (length(l.spotDirection) != 0.0){ lowp float cosAngle = dot(l.spotDirection, lightDirection); spotWeight = clamp((cosAngle - l.outerAngle) / (l.innerAngle - l.outerAngle), 0.0, 1.0); lDistance = 1.0; } lowp float shadowWeight = 1.0; mediump vec3 lWeight = getLightWeight(normal, lightDirection, l.color, l.intensity); #kt_require(shadowmap_frag_main) phongLightWeight += shadowWeight * lWeight * spotWeight / lDistance; if (shadowWeight == 1.0){ #kt_require(specular_main) }} } color.rgb *= vLightWeight + phongLightWeight; gl_FragColor = vec4(color.rgb, color.a * uOpacity); }"},depthMap:{vertexShader:"attribute mediump vec3 aVertexPosition; uniform mediump mat4 uMVPMatrix; varying mediump vec4 vVertexDepth; void main(void){ gl_Position = uMVPMatrix * vec4(aVertexPosition, 1.0); vVertexDepth = gl_Position; } ",fragmentShader:"uniform lowp float uDepthMult; varying mediump vec4 vVertexDepth; void main(void){ lowp float depth = uDepthMult * vVertexDepth.z / vVertexDepth.w; depth =  (1.0 - depth) * 15.0; if (uDepthMult == 1.0) depth = 1.0 - depth; gl_FragColor = vec4(depth, depth, depth, 1.0); }"},skybox:{vertexShader:"attribute mediump vec3 aVertexPosition; uniform mediump mat4 uMVPMatrix; varying mediump vec3 vTextureCoord;void main(void){ mediump vec4 vPos = uMVPMatrix * vec4(aVertexPosition, 1.0); gl_Position = vPos.xyww; vTextureCoord = aVertexPosition; } ",fragmentShader:"uniform samplerCube uCubemap; varying mediump vec3 vTextureCoord;void main(void){ gl_FragColor = textureCube(uCubemap, vTextureCoord); }"},modulars:{specular_in:"uniform bool uUseSpecularMap; uniform sampler2D uSpecularMapSampler; uniform lowp vec3 uSpecularColor; ",specular_main:"lowp float shininess = uShininess; if (uUseSpecularMap){ shininess = texture2D(uSpecularMapSampler, vec2(tx, ty)).r * 255.0; } if (shininess > 0.0 && shininess < 255.0){ mediump vec3 halfAngle = normalize(cameraDirection + lightDirection); mediump float specDot = max(dot(halfAngle, normal), 0.0); color += vec4(uSpecularColor, 1.0) * pow(specDot, shininess); } ",shadowmap_vert_in:"uniform bool uReceiveShadow; varying mediump vec4 vLightPosition[4]; "+functions.setLightPosition,shadowmap_vert_main:"if (uLights[i].castShadow && uReceiveShadow){ mediump vec4 lightProj = uLights[i].mvProjection * vec4(aVertexPosition, 1.0); setLightPosition(shadowIndex++, lightProj); } ",shadowmap_frag_in:"uniform bool uReceiveShadow; uniform sampler2D uShadowMaps[8]; varying mediump vec4 vLightPosition[4]; "+functions.calcShadowFactor+functions.getLightPosition,shadowmap_frag_main:"if (l.castShadow){ shadowWeight = calcShadowFactor(uShadowMaps[i], getLightPosition(shadowIndex++), l.shadowStrength, l.lightMult); } "}}},{}],33:[function(require,module){function Texture(src,params){this.__kttexture=!0;var gl=KT.gl;if(params||(params={}),this.params=params,this.minFilter=params.minFilter?params.minFilter:gl.LINEAR,this.magFilter=params.magFilter?params.magFilter:gl.LINEAR,this.wrapS=params.SWrapping?params.SWrapping:gl.REPEAT,this.wrapT=params.TWrapping?params.TWrapping:gl.REPEAT,this.repeat=params.repeat?params.repeat:new Vector2(1,1),this.offset=params.offset?params.offset:new Vector2(0,0),this.generateMipmap=params.generateMipmap?!0:!1,this.texture=null,src.data&&src.data instanceof Uint8Array)this.image=src,this.image.ready=!0,this.parseTexture();else{var T=this;this.image=KT.loadImage(src,function(){T.parseTexture()})}}var KT=require("./KTMain"),Vector2=(require("./KTUtils"),require("./KTVector2"));module.exports=Texture,Texture.prototype.parseTexture=function(){var gl=KT.gl;this.texture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,this.texture),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0),this.image instanceof Image?gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,this.image):this.image.data&&this.image.data instanceof Uint8Array&&gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this.image.width,this.image.height,0,gl.RGBA,gl.UNSIGNED_BYTE,this.image.data),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,this.magFilter),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,this.minFilter),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,this.wrapS),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,this.wrapT),this.generateMipmap&&gl.generateMipmap(gl.TEXTURE_2D),gl.bindTexture(gl.TEXTURE_2D,null)},Texture.prototype.clone=function(){return new Texture(this.image.src,this.params)}},{"./KTMain":20,"./KTUtils":37,"./KTVector2":38}],34:[function(require,module){function TextureCube(posX,negX,posY,negY,posZ,negZ,params){this.__kttexture=!0;var gl=KT.gl;params||(params={}),this.params=params,this.minFilter=params.minFilter?params.minFilter:gl.LINEAR,this.magFilter=params.magFilter?params.magFilter:gl.LINEAR,this.wrapS=params.SWrapping?params.SWrapping:gl.CLAMP_TO_EDGE,this.wrapT=params.TWrapping?params.TWrapping:gl.CLAMP_TO_EDGE,this.generateMipmap=params.generateMipmap?!0:!1,this.images=[],this.texture=null,this.images[0]=this.loadImage(posX),this.images[1]=this.loadImage(negX),this.images[2]=this.loadImage(posY),this.images[3]=this.loadImage(negY),this.images[4]=this.loadImage(posZ),this.images[5]=this.loadImage(negZ)}{var KT=require("./KTMain");require("./KTUtils"),require("./KTVector2")}module.exports=TextureCube,TextureCube.prototype.loadImage=function(src){var T=this,image=KT.loadImage(src,function(){T.parseTexture()});return image},TextureCube.prototype.parseTexture=function(){for(var i=0,len=this.images.length;len>i;i++)if(!this.images[i].ready)return;var gl=KT.gl,types=[gl.TEXTURE_CUBE_MAP_POSITIVE_X,gl.TEXTURE_CUBE_MAP_NEGATIVE_X,gl.TEXTURE_CUBE_MAP_POSITIVE_Y,gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,gl.TEXTURE_CUBE_MAP_POSITIVE_Z,gl.TEXTURE_CUBE_MAP_NEGATIVE_Z];this.texture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_CUBE_MAP,this.texture);for(var i=0;6>i;i++)gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!1),gl.texImage2D(types[i],0,gl.RGB,gl.RGB,gl.UNSIGNED_BYTE,this.images[i]);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,this.magFilter),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,this.minFilter),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_S,this.wrapS),gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_T,this.wrapT),this.generateMipmap&&gl.generateMipmap(gl.TEXTURE_CUBE_MAP),gl.bindTexture(gl.TEXTURE_CUBE_MAP,null)}},{"./KTMain":20,"./KTUtils":37,"./KTVector2":38}],35:[function(require,module){function TextureFont(imageSrc,charWidth,charHeight,charList){this.__ktfontspr=!0,this.imageSrc=imageSrc,this.charWidth=charWidth,this.charHeight=charHeight,this.charList=charList,this.hCharNum=0,this.texture=null,this.repeat=new Vector2(1,1),this.offset=new Vector2(0,0);var T=this;this.image=KT.loadImage(imageSrc,function(sprite){T.hCharNum=sprite.width/T.charWidth,T.parseImageData(),T.parseTexture()})}var KT=require("./KTMain"),Vector2=require("./KTVector2"),Vector4=require("./KTVector4");module.exports=TextureFont,TextureFont.prototype.parseImageData=function(){var cnv=document.createElement("canvas");cnv.width=this.image.width,cnv.height=this.image.height;var ctx=cnv.getContext("2d");ctx.drawImage(this.image,0,0);for(var imageData=ctx.getImageData(0,0,this.image.width,this.image.height),dataArr=[],charWidths=[],cW=0,ci=0,i=0,len=imageData.data.length;len>i;i+=4){var r=imageData.data[i],g=imageData.data[i+1],b=imageData.data[i+2],a=imageData.data[i+3];255==r&&0==g&&255==b?(a=0,cW+=1,charWidths[ci]=cW):cW>0&&(ci+=1,cW=0),dataArr.push(r,g,b,a)}this.charWidths=charWidths,this.imageData=new Uint8Array(dataArr)},TextureFont.prototype.parseTexture=function(){var gl=KT.gl;this.texture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,this.texture),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!1),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,this.image.width,this.image.height,0,gl.RGBA,gl.UNSIGNED_BYTE,this.imageData),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.bindTexture(gl.TEXTURE_2D,null)},TextureFont.prototype.getUVCoords=function(character){if(!this.image.ready)throw"Texture Font is not ready!";var ind=this.charList.indexOf(character);-1==ind&&(ind=0);var xPos=ind*this.charWidth%this.image.width/this.image.width,yPos=Math.floor(ind/this.hCharNum)*this.charHeight/this.image.height,width=xPos+this.charWidth/this.image.width*this.getCharaWidth(character),height=yPos+this.charHeight/this.image.height;return new Vector4(xPos,height,width,yPos)},TextureFont.prototype.getCharaWidth=function(character){if(!this.image.ready)throw"Texture Font is not ready!";var ind=this.charList.indexOf(character);return-1==ind?1:(this.charWidths[ind]+1)/this.charWidth}},{"./KTMain":20,"./KTVector2":38,"./KTVector4":40}],36:[function(require,module){function TextureFramebuffer(width,height,params){this.__kttextureframebuffer=!0;var gl=KT.gl;this.width=width,this.height=height,params||(params={}),this.params=params,this.minFilter=params.minFilter?params.minFilter:gl.LINEAR,this.magFilter=params.magFilter?params.magFilter:gl.LINEAR,this.wrapS=params.SWrapping?params.SWrapping:gl.CLAMP_TO_EDGE,this.wrapT=params.TWrapping?params.TWrapping:gl.CLAMP_TO_EDGE,this.repeat=params.repeat?params.repeat:new Vector2(1,1),this.offset=params.offset?params.offset:new Vector2(0,0),this.generateMipmap=params.generateMipmap?!0:!1,this.framebuffer=gl.createFramebuffer(),gl.bindFramebuffer(gl.FRAMEBUFFER,this.framebuffer),this.framebuffer.width=width,this.framebuffer.height=height,this.texture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,this.texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,this.magFilter),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,this.minFilter),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,this.wrapS),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,this.wrapT),this.generateMipmap&&gl.generateMipmap(gl.TEXTURE_2D),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,width,height,0,gl.RGBA,gl.UNSIGNED_BYTE,null),this.renderBuffer=gl.createRenderbuffer(),gl.bindRenderbuffer(gl.RENDERBUFFER,this.renderBuffer),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,width,height),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.texture,0),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,this.renderBuffer),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.bindTexture(gl.TEXTURE_2D,null),gl.bindRenderbuffer(gl.RENDERBUFFER,null)
}var KT=require("./KTMain"),Vector2=require("./KTVector2");module.exports=TextureFramebuffer},{"./KTMain":20,"./KTVector2":38}],37:[function(require,module){module.exports={get:function(element){return"#"==element.charAt(0)?document.getElementById(element.replace("#","")):"."==element.charAt(0)?document.getElementsByClassName(element.replace(".","")):document.getElementsByTagName(element)},addEvent:function(element,type,callback){element.addEventListener?element.addEventListener(type,callback,!1):element.attachEvent&&element.attachEvent("on"+type,callback)},getHttp:function(){return window.XMLHttpRequest?new XMLHttpRequest:(window.ActiveXObject&&(http=new window.ActiveXObject("Microsoft.XMLHTTP")),null)},getFileContent:function(fileURL,callback){var http=this.getHttp();http.open("GET",fileURL,!0),http.onreadystatechange=function(){4==http.readyState&&200==http.status&&callback&&callback(http.responseText)},http.send()}}},{}],38:[function(require,module){function Vector2(x,y){this.__ktv2=!0,this.x=x,this.y=y}module.exports=Vector2,Vector2.prototype.length=function(){var length=Math.sqrt(this.x*this.x+this.y*this.y);return length},Vector2.prototype.normalize=function(){var length=this.length();return this.x/=length,this.y/=length,this},Vector2.prototype.dot=function(vector2){if(!vector2.__ktv2)throw"Can only perform a dot product with a vector2";return this.x*vector2.x+this.y*vector2.y},Vector2.prototype.invert=function(){return this.multiply(-1)},Vector2.prototype.multiply=function(number){return this.x*=number,this.y*=number,this},Vector2.prototype.add=function(vector2){if(!vector2.__ktv2)throw"Can only add a vector2 to this vector";return this.x+=vector2.x,this.y+=vector2.y,this},Vector2.prototype.copy=function(vector2){if(!vector2.__ktv2)throw"Can only copy a vector2 to this vector";return this.x=vector2.x,this.y=vector2.y,this},Vector2.prototype.set=function(x,y){return this.x=x,this.y=y,this},Vector2.prototype.clone=function(){return new Vector2(this.x,this.y)},Vector2.prototype.equals=function(vector2){if(!vector2.__ktv2)throw"Can only copy a vector2 to this vector";return this.x==vector2.x&&this.y==vector2.y},Vector2.vectorsDifference=function(vector2_a,vector2_b){if(!vector2_a.__ktv2)throw"Can only create this vector using 2 vectors2";if(!vector2_b.__ktv2)throw"Can only create this vector using 2 vectors2";return new Vector2(vector2_a.x-vector2_b.x,vector2_a.y-vector2_b.y)},Vector2.fromAngle=function(radian){var x=Math.cos(radian),y=-Math.sin(radian);return new Vector2(x,y)}},{}],39:[function(require,module){function Vector3(x,y,z){this.__ktv3=!0,this.x=x,this.y=y,this.z=z}module.exports=Vector3,Vector3.prototype.length=function(){var length=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return length},Vector3.prototype.normalize=function(){var length=this.length();return this.x/=length,this.y/=length,this.z/=length,this},Vector3.prototype.dot=function(vector3){if(!vector3.__ktv3)throw"Can only perform a dot product with a vector3";return this.x*vector3.x+this.y*vector3.y+this.z*vector3.z},Vector3.prototype.cross=function(vector3){if(!vector3.__ktv3)throw"Can only perform a cross product with a vector3";return new Vector3(this.y*vector3.z-this.z*vector3.y,this.z*vector3.x-this.x*vector3.z,this.x*vector3.y-this.y*vector3.x)},Vector3.prototype.invert=function(){return this.multiply(-1)},Vector3.prototype.multiply=function(number){return this.x*=number,this.y*=number,this.z*=number,this},Vector3.prototype.add=function(vector3){if(!vector3.__ktv3)throw"Can only add a Vector3 to this vector";return this.x+=vector3.x,this.y+=vector3.y,this.z+=vector3.z,this},Vector3.prototype.copy=function(vector3){if(!vector3.__ktv3)throw"Can only copy a Vector3 to this vector";return this.x=vector3.x,this.y=vector3.y,this.z=vector3.z,this},Vector3.prototype.set=function(x,y,z){return this.x=x,this.y=y,this.z=z,this},Vector3.prototype.clone=function(){return new Vector3(this.x,this.y,this.z)},Vector3.prototype.equals=function(vector3){if(!vector3.__ktv3)throw"Can only copy a Vector3 to this vector";return this.x==vector3.x&&this.y==vector3.y&&this.z==vector3.z},Vector3.vectorsDifference=function(vector3_a,vector3_b){if(!vector3_a.__ktv3)throw"Can only create this vector using 2 vectors3";if(!vector3_b.__ktv3)throw"Can only create this vector using 2 vectors3";return new Vector3(vector3_a.x-vector3_b.x,vector3_a.y-vector3_b.y,vector3_a.z-vector3_b.z)},Vector3.fromAngle=function(radian_xz,radian_y){var x=Math.cos(radian_xz),y=Math.sin(radian_y),z=-Math.sin(radian_xz);return new Vector3(x,y,z)}},{}],40:[function(require,module){function Vector4(x,y,z,w){this.__ktv4=!0,this.x=x,this.y=y,this.z=z,this.w=w}module.exports=Vector4,Vector4.prototype.length=function(){var length=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return length},Vector4.prototype.normalize=function(){var length=this.length();return this.x/=length,this.y/=length,this.z/=length,this.w/=length,this},Vector4.prototype.dot=function(vector4){if(!vector4.__ktv4)throw"Can only perform a dot product with a vector4";return this.x*vector4.x+this.y*vector4.y+this.z*vector4.z+this.w*vector4.w},Vector4.prototype.invert=function(){return this.multiply(-1)},Vector4.prototype.multiply=function(number){return this.x*=number,this.y*=number,this.z*=number,this.w*=number,this},Vector4.prototype.add=function(vector4){if(!vector4.__ktv4)throw"Can only add a vector4 to this vector";return this.x+=vector4.x,this.y+=vector4.y,this.z+=vector4.z,this.w+=vector4.w,this},Vector4.prototype.copy=function(vector4){if(!vector4.__ktv4)throw"Can only copy a vector4 to this vector";return this.x=vector4.x,this.y=vector4.y,this.z=vector4.z,this.w=vector4.w,this},Vector4.prototype.set=function(x,y,z,w){return this.x=x,this.y=y,this.z=z,this.w=w,this},Vector4.prototype.clone=function(){return new vector4(this.x,this.y,this.z,this.w)},Vector4.prototype.equals=function(vector4){if(!vector4.__ktv4)throw"Can only copy a vector4 to this vector";return this.x==vector4.x&&this.y==vector4.y&&this.z==vector4.z&&this.w==vector4.w},Vector4.vectorsDifference=function(vector4_a,vector4_b){if(!vector4_a.__ktv4)throw"Can only create this vector using 2 vectors4";if(!vector4_b.__ktv4)throw"Can only create this vector using 2 vectors4";return new vector4(vector4_a.x-vector4_b.x,vector4_a.y-vector4_b.y,vector4_a.z-vector4_b.z,vectpr4_a.w-vector4_b.w)}},{}],41:[function(require,module){var KT=require("./KTMain");KT.CameraFly=require("./KTCameraFly"),KT.CameraOrtho=require("./KTCameraOrtho"),KT.CameraPerspective=require("./KTCameraPerspective"),KT.Color=require("./KTColor"),KT.Geometry=require("./KTGeometry"),KT.Geometry3DModel=require("./KTGeometry3DModel"),KT.GeometryBillboard=require("./KTGeometryBillboard"),KT.GeometryBox=require("./KTGeometryBox"),KT.GeometryCylinder=require("./KTGeometryCylinder"),KT.GeometryPlane=require("./KTGeometryPlane"),KT.GeometrySkybox=require("./KTGeometrySkybox"),KT.GeometrySphere=require("./KTGeometrySphere"),KT.GeometryText=require("./KTGeometryText"),KT.GeometryGUITexture=require("./KTGeometryGUITexture"),KT.LightDirectional=require("./KTLightDirectional"),KT.LightPoint=require("./KTLightPoint"),KT.LightSpot=require("./KTLightSpot"),KT.Input=require("./KTInput"),KT.Material=require("./KTMaterial"),KT.MaterialBasic=require("./KTMaterialBasic"),KT.MaterialLambert=require("./KTMaterialLambert"),KT.MaterialPhong=require("./KTMaterialPhong"),KT.Math=require("./KTMath"),KT.Matrix3=require("./KTMatrix3"),KT.Matrix4=require("./KTMatrix4"),KT.Mesh=require("./KTMesh"),KT.MeshSprite=require("./KTMeshSprite"),KT.OrbitAndPan=require("./KTOrbitAndPan"),KT.Texture=require("./KTTexture"),KT.TextureCube=require("./KTTextureCube"),KT.TextureFont=require("./KTTextureFont"),KT.TextureFramebuffer=require("./KTTextureFramebuffer"),KT.Utils=require("./KTUtils"),KT.Vector2=require("./KTVector2"),KT.Vector3=require("./KTVector3"),KT.Vector4=require("./KTVector4"),KT.Scene=require("./KTScene"),module.exports=KT},{"./KTCameraFly":1,"./KTCameraOrtho":2,"./KTCameraPerspective":3,"./KTColor":5,"./KTGeometry":6,"./KTGeometry3DModel":7,"./KTGeometryBillboard":8,"./KTGeometryBox":9,"./KTGeometryCylinder":10,"./KTGeometryGUITexture":11,"./KTGeometryPlane":12,"./KTGeometrySkybox":13,"./KTGeometrySphere":14,"./KTGeometryText":15,"./KTInput":16,"./KTLightDirectional":17,"./KTLightPoint":18,"./KTLightSpot":19,"./KTMain":20,"./KTMaterial":21,"./KTMaterialBasic":22,"./KTMaterialLambert":23,"./KTMaterialPhong":24,"./KTMath":25,"./KTMatrix3":26,"./KTMatrix4":27,"./KTMesh":28,"./KTMeshSprite":29,"./KTOrbitAndPan":30,"./KTScene":31,"./KTTexture":33,"./KTTextureCube":34,"./KTTextureFont":35,"./KTTextureFramebuffer":36,"./KTUtils":37,"./KTVector2":38,"./KTVector3":39,"./KTVector4":40}],42:[function(require){window.KT=require("./KramTech")},{"./KramTech":41}]},{},[42]);